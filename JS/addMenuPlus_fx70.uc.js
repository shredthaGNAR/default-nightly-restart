{"payload":{"allShortcutsEnabled":true,"fileTree":{"userChromeJS/addMenuPlus":{"items":[{"name":"images","path":"userChromeJS/addMenuPlus/images","contentType":"directory"},{"name":"README.md","path":"userChromeJS/addMenuPlus/README.md","contentType":"file"},{"name":"_addmenu.js","path":"userChromeJS/addMenuPlus/_addmenu.js","contentType":"file"},{"name":"addMenuPlus.uc.js","path":"userChromeJS/addMenuPlus/addMenuPlus.uc.js","contentType":"file"},{"name":"addMenuPlus_fx70.uc.js","path":"userChromeJS/addMenuPlus/addMenuPlus_fx70.uc.js","contentType":"file"}],"totalCount":5},"userChromeJS":{"items":[{"name":"102","path":"userChromeJS/102","contentType":"directory"},{"name":"103","path":"userChromeJS/103","contentType":"directory"},{"name":"104","path":"userChromeJS/104","contentType":"directory"},{"name":"107","path":"userChromeJS/107","contentType":"directory"},{"name":"109","path":"userChromeJS/109","contentType":"directory"},{"name":"113","path":"userChromeJS/113","contentType":"directory"},{"name":"68","path":"userChromeJS/68","contentType":"directory"},{"name":"70","path":"userChromeJS/70","contentType":"directory"},{"name":"78","path":"userChromeJS/78","contentType":"directory"},{"name":"90","path":"userChromeJS/90","contentType":"directory"},{"name":"91.11ESR","path":"userChromeJS/91.11ESR","contentType":"directory"},{"name":"95","path":"userChromeJS/95","contentType":"directory"},{"name":"96","path":"userChromeJS/96","contentType":"directory"},{"name":"CopyCatTheme","path":"userChromeJS/CopyCatTheme","contentType":"directory"},{"name":"ExtensionsOptionsMenu","path":"userChromeJS/ExtensionsOptionsMenu","contentType":"directory"},{"name":"KeyChanger","path":"userChromeJS/KeyChanger","contentType":"directory"},{"name":"Loader","path":"userChromeJS/Loader","contentType":"directory"},{"name":"Screenshots","path":"userChromeJS/Screenshots","contentType":"directory"},{"name":"VideoBtn","path":"userChromeJS/VideoBtn","contentType":"directory"},{"name":"addMenuPlus","path":"userChromeJS/addMenuPlus","contentType":"directory"},{"name":"downloadPlus","path":"userChromeJS/downloadPlus","contentType":"directory"},{"name":"privateTab","path":"userChromeJS/privateTab","contentType":"directory"},{"name":"000-xiaoxiaoflood.uc.js","path":"userChromeJS/000-xiaoxiaoflood.uc.js","contentType":"file"},{"name":"AddonsPage_fx72.uc.js","path":"userChromeJS/AddonsPage_fx72.uc.js","contentType":"file"},{"name":"AutoCopySelectionText.uc.js","path":"userChromeJS/AutoCopySelectionText.uc.js","contentType":"file"},{"name":"AutoHideTabsToolbar.uc.js","path":"userChromeJS/AutoHideTabsToolbar.uc.js","contentType":"file"},{"name":"AutoPopup.uc.js","path":"userChromeJS/AutoPopup.uc.js","contentType":"file"},{"name":"BMMultiColumn.uc.js","path":"userChromeJS/BMMultiColumn.uc.js","contentType":"file"},{"name":"BaiduTranslator.uc.js","path":"userChromeJS/BaiduTranslator.uc.js","contentType":"file"},{"name":"BookmarkOpt.uc.js","path":"userChromeJS/BookmarkOpt.uc.js","contentType":"file"},{"name":"ColorfulTabs.uc.js","path":"userChromeJS/ColorfulTabs.uc.js","contentType":"file"},{"name":"CopyCat.uc.js","path":"userChromeJS/CopyCat.uc.js","contentType":"file"},{"name":"CopyPlainText.uc.js","path":"userChromeJS/CopyPlainText.uc.js","contentType":"file"},{"name":"CustomButtons.uc.js","path":"userChromeJS/CustomButtons.uc.js","contentType":"file"},{"name":"HomeEndFixer.uc.js","path":"userChromeJS/HomeEndFixer.uc.js","contentType":"file"},{"name":"LocationBar.uc.js","path":"userChromeJS/LocationBar.uc.js","contentType":"file"},{"name":"MenubarReplaceWithButton.uc.js","path":"userChromeJS/MenubarReplaceWithButton.uc.js","contentType":"file"},{"name":"OpenWith.uc.js","path":"userChromeJS/OpenWith.uc.js","contentType":"file"},{"name":"PipMod.uc.js","path":"userChromeJS/PipMod.uc.js","contentType":"file"},{"name":"README.md","path":"userChromeJS/README.md","contentType":"file"},{"name":"SidebarModoki.uc.js","path":"userChromeJS/SidebarModoki.uc.js","contentType":"file"},{"name":"StatusBar.uc.js","path":"userChromeJS/StatusBar.uc.js","contentType":"file"},{"name":"TabPlus.uc.js","path":"userChromeJS/TabPlus.uc.js","contentType":"file"},{"name":"ToolbarAutoHide.uc.js","path":"userChromeJS/ToolbarAutoHide.uc.js","contentType":"file"},{"name":"UndoCloseTabButtonN.uc.js","path":"userChromeJS/UndoCloseTabButtonN.uc.js","contentType":"file"},{"name":"autoPopup++.uc.js","path":"userChromeJS/autoPopup++.uc.js","contentType":"file"},{"name":"browsertoolbox.uc.js","path":"userChromeJS/browsertoolbox.uc.js","contentType":"file"},{"name":"dav_LinkifiesLocationBar.uc.js","path":"userChromeJS/dav_LinkifiesLocationBar.uc.js","contentType":"file"},{"name":"extensionStylesheetLoader.uc.js","path":"userChromeJS/extensionStylesheetLoader.uc.js","contentType":"file"},{"name":"middleClickOpenTabContextMenu.uc.js","path":"userChromeJS/middleClickOpenTabContextMenu.uc.js","contentType":"file"},{"name":"miscMods.uc.js","path":"userChromeJS/miscMods.uc.js","contentType":"file"},{"name":"movableOverflowButton.uc.js","path":"userChromeJS/movableOverflowButton.uc.js","contentType":"file"},{"name":"movablePanelUIButton.uc.js","path":"userChromeJS/movablePanelUIButton.uc.js","contentType":"file"},{"name":"moveReloadIntoUrl.uc.js","path":"userChromeJS/moveReloadIntoUrl.uc.js","contentType":"file"},{"name":"rebuild_userChrome.uc.js","path":"userChromeJS/rebuild_userChrome.uc.js","contentType":"file"},{"name":"restoreOldStyleCleanHistory.uc.js","path":"userChromeJS/restoreOldStyleCleanHistory.uc.js","contentType":"file"},{"name":"restoreOldStyleLaunchApplication.uc.js","path":"userChromeJS/restoreOldStyleLaunchApplication.uc.js","contentType":"file"},{"name":"saveUCJS.uc.js","path":"userChromeJS/saveUCJS.uc.js","contentType":"file"},{"name":"setViewSourceEditor.uc.js","path":"userChromeJS/setViewSourceEditor.uc.js","contentType":"file"},{"name":"showLimitedTimeTheme.uc.js","path":"userChromeJS/showLimitedTimeTheme.uc.js","contentType":"file"},{"name":"sidebarAttrubesDetector.uc.js","path":"userChromeJS/sidebarAttrubesDetector.uc.js","contentType":"file"},{"name":"syncTabsMod.uc.js","path":"userChromeJS/syncTabsMod.uc.js","contentType":"file"},{"name":"tabNotifitionBadge.uc.js","path":"userChromeJS/tabNotifitionBadge.uc.js","contentType":"file"},{"name":"textZoomPerDomain_e10s.uc.js","path":"userChromeJS/textZoomPerDomain_e10s.uc.js","contentType":"file"},{"name":"textZoomTool.uc.js","path":"userChromeJS/textZoomTool.uc.js","contentType":"file"},{"name":"toggleExtensions.uc.js","path":"userChromeJS/toggleExtensions.uc.js","contentType":"file"},{"name":"ucf_drag_ModR.uc.js","path":"userChromeJS/ucf_drag_ModR.uc.js","contentType":"file"},{"name":"uiDensity.uc.js","path":"userChromeJS/uiDensity.uc.js","contentType":"file"},{"name":"unifiedExtensionsEnhance.uc.js","path":"userChromeJS/unifiedExtensionsEnhance.uc.js","contentType":"file"},{"name":"unreadTabMods.uc.js","path":"userChromeJS/unreadTabMods.uc.js","contentType":"file"},{"name":"verticalAddOnBar.uc.js","path":"userChromeJS/verticalAddOnBar.uc.js","contentType":"file"},{"name":"verticalTabsPane.uc.js","path":"userChromeJS/verticalTabsPane.uc.js","contentType":"file"}],"totalCount":72},"":{"items":[{"name":".github","path":".github","contentType":"directory"},{"name":"UserConfig","path":"UserConfig","contentType":"directory"},{"name":"UserScript","path":"UserScript","contentType":"directory"},{"name":"UserThemes","path":"UserThemes","contentType":"directory"},{"name":"UserTools","path":"UserTools","contentType":"directory"},{"name":"extensions","path":"extensions","contentType":"directory"},{"name":"images","path":"images","contentType":"directory"},{"name":"userChromeJS","path":"userChromeJS","contentType":"directory"},{"name":".gitattributes","path":".gitattributes","contentType":"file"},{"name":"README.md","path":"README.md","contentType":"file"}],"totalCount":10}},"fileTreeProcessingTime":14.868414999999999,"foldersToFetch":[],"repo":{"id":103213641,"defaultBranch":"master","name":"FirefoxCustomize","ownerLogin":"benzBrake","currentUserCanPush":false,"isFork":false,"isEmpty":false,"createdAt":"2017-09-11T19:46:42.000-07:00","ownerAvatar":"https://avatars.githubusercontent.com/u/11323774?v=4","public":true,"private":false,"isOrgOwned":false},"refInfo":{"name":"master","listCacheKey":"v0:1505199059.0","canEdit":true,"refType":"branch","currentOid":"88b44db0e6a51048f527adc91655918201cc46f3"},"currentUser":{"id":37919512,"login":"shredthaGNAR","userEmail":"wynstaxxx@gmail.com"},"editInfo":{"customSlashCommandsDocsUrl":"https://docs.github.com/early-access/github/save-time-with-slash-commands/syntax-for-user-defined-slash-commands","markdownDocsUrl":"https://docs.github.com/github/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax","content":"// ==UserScript==\n// @name           addMenuPlus.uc.js\n// @description    通过配置文件增加修改菜单，修改版\n// @namespace      http://d.hatena.ne.jp/Griever/\n// @author         Ryan, ywzhaiqi, Griever\n// @include        main\n// @license        MIT License\n// @compatibility  Firefox 70\n// @charset        UTF-8\n// @version        0.2.1\n// @shutdown       window.addMenu.destroy();\n// @homepageURL    https://github.com/benzBrake/FirefoxCustomize/tree/master/userChromeJS/addMenuPlus\n// @downloadURL    https://github.com/ywzhaiqi/userChromeJS/raw/master/addmenuPlus/addMenuPlus.uc.js\n// @reviewURL      https://bbs.kafan.cn/thread-2246475-1-1.html\n// @note           0.2.1 fix openUILinkIn was removed, Bug 1820534 - Move front-end to modern flexbox, 修复 about:error 页面获取的地址不对, Bug 1815439 - Remove useless loadURI wrapper from browser.js, 扩展 %FAVICON% %FAVICON_BASE64% 的应用范围, condition 支持多个条件\n// @note           0.2.0 采用 JSWindowActor 与内容进程通信（替代 e10s 时代的 loadFrameScript，虽然目前还能用），修复 onshowing 仅在页面右键生效的 bug，修复合并窗口后 CSS 失效的问题\n// @note           0.1.4 onshowing/onshowinglabel 在所有右键菜单生效\n// @note           0.1.3 修正 Firefox 78 (?应该是吧) openUILinkIn 参数变更；Firefox 92 getURLSpecFromFile 废止，切换到 getURLSpecFromActualFile；添加到文件菜单的 app/appmenu 菜单自动移动到汉堡菜单, 修复 keyword 调用搜索引擎失效的问题，没有 label 并使用 keyword 调用搜索引擎时设置 label 为搜素引擎名称；增加 onshowinglabel 属性，增加本地化属性 data-l10n-href 以及 data-l10n-id；修正右键未显示时无法获取选中文本，增加菜单类型 nav （navigator-toolbox的右键菜单），兼容 textLink_e10s.uc.js，增加移动的菜单无需重启浏览器即可还原，增加 identity-box 右键菜单, getSelectionText 完美修复，支持内置页面，修复右键菜单获取选中文本不完整\n// @note           0.1.2 增加多语言；修复 %I %IMAGE_URL% %IMAGE_BASE64% 转换为空白字符串；GroupMenu 增加 onshowing 事件\n// @note           0.1.1 Places keywords API を使うようにした\n// @note           0.1.0 menugroup をとりあえず利用できるようにした\n// @note           0.0.9 Firefox 29 の Firefox Button 廃止に伴いファイルメニューに追加するように変更\n// @note           0.0.8 Firefox 25 の getShortcutOrURI 廃止に仮対応\n// @note           0.0.7 Firefox 21 の Favicon 周りの変更に対応\n// @note           0.0.6 Firefox 19 に合わせて修正\n// @note           0.0.5 Remove E4X\n// @note           0.0.4 設定ファイルから CSS を追加できるようにした\n// @note           0.0.4 label の無い menu を splitmenu 風の動作にした\n// @note           0.0.4 Vista でアイコンがズレる問題を修正…したかも\n// @note           0.0.4 %SEL% の改行が消えてしまうのを修正\n// @note           0.0.3 keyword の新しい書式で古い書式が動かない場合があったのを修正\n// @note           %URL_HTMLIFIED%, %EOL_ENCODE% が変換できなかったミスを修正\n// @note           %LINK_OR_URL% 変数を作成（リンク URL がなければページの URL を返す）\n// @note           タブの右クリックメニューでは %URL% や %SEL% はそのタブのものを返すようにした\n// @note           keyword で \"g %URL%\" のような記述を可能にした\n// @note           ツールの再読み込みメニューの右クリックで設定ファイルを開くようにした\n// @note           修复支持57+\n// ==/UserScript==\nif (typeof window === \"undefined\" || globalThis !== window) {\n    let BrowserOrSelectionUtils = Cu.import(\"resource://gre/modules/BrowserUtils.jsm\").BrowserUtils\n    try {\n        if (!BrowserOrSelectionUtils.hasOwnProperty(\"getSelectionDetails\")) {\n            BrowserOrSelectionUtils = Cu.import(\"resource://gre/modules/SelectionUtils.jsm\").SelectionUtils;\n        }\n    } catch (e) { }\n    if (!Services.appinfo.remoteType) {\n        this.EXPORTED_SYMBOLS = [\"AddMenuParent\"];\n        try {\n            const actorParams = {\n                parent: {\n                    moduleURI: __URI__,\n                },\n                child: {\n                    moduleURI: __URI__,\n                    events: {},\n                },\n                allFrames: true,\n                messageManagerGroups: [\"browsers\"],\n                matches: [\"*://*/*\", \"file:///*\", \"about:*\", \"view-source:*\", \"moz-extension://*/*\"],\n            };\n            ChromeUtils.registerWindowActor(\"AddMenu\", actorParams);\n        } catch (e) { console.error(e); }\n\n        this.AddMenuParent = class extends JSWindowActorParent {\n            receiveMessage({ name, data }) {\n                // https://searchfox.org/mozilla-central/rev/43ee5e789b079e94837a21336e9ce2420658fd19/browser/actors/ContextMenuParent.sys.mjs#60-63\n                let windowGlobal = this.manager.browsingContext.currentWindowGlobal;\n                let browser = windowGlobal.rootFrameLoader.ownerElement;\n                let win = browser.ownerGlobal;\n                let addMenu = win.addMenu;\n                switch (name) {\n                    case \"AM:SetSeletedText\":\n                        addMenu.setSelectedText(data.text);\n                        break;\n                    case \"AM:FaviconLink\":\n                        if (typeof data.href !== \"undefined\" && typeof data.hash !== \"undefined\") {\n                            win.gBrowser.tabs.filter(t => t.faviconHash === data.hash).forEach(t => t.faviconUrl = data.href);\n                        }\n                        break;\n                    case \"AM:ExectueScriptEnd\":\n                        break;\n                }\n            }\n        }\n    } else {\n        this.EXPORTED_SYMBOLS = [\"AddMenuChild\"];\n\n        this.AddMenuChild = class extends JSWindowActorChild {\n            actorCreated() {\n\n            }\n            receiveMessage({ name, data }) {\n                const win = this.contentWindow;\n                const console = win.console;\n                const doc = win.document;\n                const actor = win.windowGlobalChild.getActor(\"AddMenu\");\n                switch (name) {\n                    case \"AM:GetSelectedText\":\n                        let obj = {\n                            text: BrowserOrSelectionUtils.getSelectionDetails(win).fullText\n                        }\n                        actor.sendAsyncMessage(\"AM:SetSeletedText\", obj);\n                        break;\n                    case \"AM:GetFaviconLink\":\n                        if (doc.location.href.startsWith(\"about\")) return;\n                        if (!\"head\" in doc) return;\n                        let link = doc.head.querySelector('[rel~=\"shortcut\"]');\n                        let href = \"\";\n                        if (link) {\n                            href = link.getAttribute(\"href\");\n                            if (href.startsWith(\"//\")) {\n                                href = doc.location.protocol + href;\n                            } else if (href.startsWith(\"/\")) {\n                                href = doc.location.protocol + \"//\" + doc.location.host + \"/\" + href;\n                            }\n                        } else {\n                            href = doc.location.protocol + \"//\" + doc.location.host + \"/\" + \"favicon.ico\";\n                        }\n                        actor.sendAsyncMessage(\"AM:FaviconLink\", { href: href, hash: data.hash });\n                        break;\n                    case \"AM:ExectueScript\":\n                        if (data && data.script) {\n                            eval('(' + decodeURIComponent(atob(data.script)) + ').call(this, doc, win, actor)');\n                        }\n                        break;\n                }\n            }\n        }\n    }\n} else {\n    try {\n        if (parseInt(Services.appinfo.version) < 101) {\n            ChromeUtils.import(Components.stack.filename);\n        } else {\n            let fileHandler = Services.io.getProtocolHandler(\"file\").QueryInterface(Ci.nsIFileProtocolHandler);\n            let scriptPath = Components.stack.filename;\n            if (scriptPath.startsWith(\"chrome\")) {\n                scriptPath = resolveChromeURL(scriptPath);\n                function resolveChromeURL(str) {\n                    const registry = Cc[\"@mozilla.org/chrome/chrome-registry;1\"].getService(Ci.nsIChromeRegistry);\n                    try {\n                        return registry.convertChromeURL(Services.io.newURI(str.replace(/\\\\/g, \"/\"))).spec\n                    } catch (e) {\n                        console.error(e);\n                        return \"\"\n                    }\n                }\n            }\n            let scriptFile = fileHandler.getFileFromURLSpec(scriptPath);\n            let resourceHandler = Services.io.getProtocolHandler(\"resource\").QueryInterface(Ci.nsIResProtocolHandler);\n            if (!resourceHandler.hasSubstitution(\"addmenu-ucjs\")) {\n                resourceHandler.setSubstitution(\"addmenu-ucjs\", Services.io.newFileURI(scriptFile.parent));\n            }\n            ChromeUtils.import(`resource://addmenu-ucjs/${encodeURIComponent(scriptFile.leafName)}?${scriptFile.lastModifiedTime}`);\n        }\n    } catch (e) { console.error(e); }\n    (function (css) {\n        let {\n            classes: Cc,\n            interfaces: Ci,\n            utils: Cu,\n            results: Cr\n        } = Components;\n\n        let BrowserOrSelectionUtils = Cu.import(\"resource://gre/modules/BrowserUtils.jsm\").BrowserUtils\n        try {\n            if (!BrowserOrSelectionUtils.hasOwnProperty(\"getSelectionDetails\")) {\n                BrowserOrSelectionUtils = Cu.import(\"resource://gre/modules/SelectionUtils.jsm\").SelectionUtils;\n            }\n        } catch (e) { }\n\n        var useScraptchpad = true; // 如果不存在编辑器，则使用代码片段速记器，否则设置编辑器路径\n        var enableFileRefreshing = false; // 打开右键菜单时，检查配置文件是否变化，可能会减慢速度\n        var onshowinglabelMaxLength = 15; // 通过 onshowinglabel 设置标签的标签最大长度\n        var enableidentityBoxContextMenu = true; // 启用 SSL 状态按钮右键菜单\n        var enableContentAreaContextMenuCompact = true; // Photon 界面下右键菜单兼容开关，有需要再开\n\n        if (window && window.addMenu) {\n            window.addMenu.destroy();\n            delete window.addMenu;\n        }\n\n        const ADDMENU_LANG = {\n            'zh-CN': {\n                'config example': '// 这是一个 addMenuPlus 配置文件\\n' +\n                    '// 请到 http://ywzhaiqi.github.io/addMenu_creator/ 生成配置文件' +\n                    '\\n\\n' +\n                    'tab({\\n    label: \"addMenuPlus 配置\",\\n    oncommand: \"addMenu.edit(addMenu.FILE);\"\\n});',\n                'example is empty': '目前 addMenuPlus 的配置文件为空，请在打开的链接中生成配置并放入配置文件。\\n通过右键标签打开配置文件。',\n                'addmenuplus label': 'addMenuPlus',\n                'addmenuplus tooltip': '左键：重载配置\\n右键：编辑配置',\n                'custom showing method error': 'addMenuPlus 自定义显示错误',\n                'url is invalid': 'URL 不正确: %s',\n                'config file': '配置文件',\n                'not exists': ' 不存在',\n                'check config file with line': '\\n请重新检查配置文件第 %s 行',\n                'file not found': '文件不存在: %s',\n                'config has reload': '配置已经重新载入',\n                'please set editor path': '请先设置编辑器的路径!!!',\n                'set global editor': '设置全局脚本编辑器',\n                'executable files': '执行文件',\n                'could not load': '无法载入：%s'\n            },\n            'en-US': {\n                'config example': '// This is an addMenuPlus configuration file.\\n' +\n                    '// Please visit http://ywzhaiqi.github.io/addMenu_creator/ to generate configuration.' +\n                    '\\n\\n' +\n                    'tab({\\n    label: \"Edit addMenuPlus Configuration\",\\n    oncommand: \"addMenu.edit(addMenu.FILE);\"\\n});',\n                'example is empty': 'The configuration file for addMenuPlus is currently empty, please generate the configuration and put it in the configuration file in the open link. \\nOpen the configuration file by right-clicking the tab.',\n                'addmenuplus label': 'addMenuPlus',\n                'addmenuplus tooltip': 'Left Click：Reload configuration\\nRight Click：Edit configuration',\n                'custom showing method error': 'addMenuPlus customize popupshow error',\n                'url is invalid': 'URL is invalid: %s',\n                'config file': 'Configuration file',\n                'not exists': ' not exists',\n                'check config file with line': '\\nPlease recheck line %s of the configuration file',\n                'file not found': 'File not found: %s',\n                'config has reload': 'The configuration has been reloaded',\n                'please set editor path': 'Please set the path to the editor first!!!',\n                'set global editor': 'Setting up the global script editor',\n                'executable files': 'Executable files',\n                'could not load': 'Could not load：%s'\n            },\n        }\n\n        // 读取语言代码\n        let _locale;\n        try {\n            let _locales, osPrefs = Cc[\"@mozilla.org/intl/ospreferences;1\"].getService(Ci.mozIOSPreferences);\n            if (osPrefs.hasOwnProperty(\"getRegionalPrefsLocales\").hasOwnProperty(\"getRegionalPrefsLocales\"))\n                _locales = osPrefs.getRegionalPrefsLocales();\n            else\n                _locales = osPrefs.regionalPrefsLocales;\n            for (let i = 0; i < _locales.length; i++) {\n                if (ADDMENU_LANG.hasOwnProperty(_locales[i])) {\n                    _locale = _locales[i];\n                    break;\n                }\n            }\n        } catch (e) { }\n        const ADDMENU_LOCALE = _locale || \"en-US\";\n\n        // 增加菜单类型请在这里加入插入点，名称不能是 ident 或者 group\n        var MENU_ATTRS = {\n            tab: {\n                insRef: $(\"context_closeTab\"),\n                current: \"tab\",\n                submenu: \"TabMenu\",\n                groupmenu: \"TabGroup\"\n            },\n            page: {\n                insRef: $(\"context-viewsource\"),\n                current: \"page\",\n                submenu: \"PageMenu\",\n                groupmenu: \"PageGroup\"\n            },\n            tool: {\n                insRef: $(\"prefSep\") || $(\"webDeveloperMenu\"),\n                current: \"tool\",\n                submenu: \"ToolMenu\",\n                groupmenu: \"ToolGroup\"\n            },\n            app: {\n                insRef: $(\"appmenu-quit\") || $(\"appMenu-quit-button\") || $(\"appMenu-quit-button2\") || $(\"menu_FileQuitItem\"),\n                current: \"app\",\n                submenu: \"AppMenu\",\n                groupmenu: \"AppGroup\"\n            },\n            nav: {\n                insRef: $(\"toolbar-context-undoCloseTab\") || $(\"toolbarItemsMenuSeparator\"),\n                current: \"nav\",\n                submenu: \"NavMenu\",\n                groupmenu: \"NavGroup\"\n            }\n        };\n\n        window.addMenu = {\n            _selectedText: \"\",\n            get prefs() {\n                delete this.prefs;\n                return this.prefs = Services.prefs.getBranch(\"addMenu.\")\n            },\n            get appVersion() {\n                delete this.appVersion;\n                return this.appVersion = parseFloat(Services.appinfo.version);\n            },\n            get platform() {\n                delete this.platform;\n                return this.platform = AppConstants.platform;\n            },\n            get FILE() {\n                let path;\n                try {\n                    // addMenu.FILE_PATH があればそれを使う\n                    path = this.prefs.getStringPref(\"FILE_PATH\")\n                } catch (e) {\n                    path = '_addmenu.js';\n                }\n\n                aFile = Services.dirsvc.get(\"UChrm\", Ci.nsIFile);\n                aFile.appendRelativePath(path);\n\n                if (!aFile.exists()) {\n                    saveFile(aFile, $L('config example'));\n                    alert($L('example is empty'));\n                    addMenu.openCommand({\n                        target: this\n                    }, 'https://ywzhaiqi.github.io/addMenu_creator/', 'tab');\n                }\n\n                this._modifiedTime = aFile.lastModifiedTime;\n                delete this.FILE;\n                return this.FILE = aFile;\n            },\n            get focusedWindow() {\n                return (gContextMenu && gContextMenu.target) ? gContextMenu.target.ownerDocument.defaultView : document.commandDispatcher.focusedWindow || content;\n            },\n            get supportLocalization() {\n                delete this.supportLocalization;\n                return this.supportLocalization = typeof Localization === \"function\";\n            },\n            get locale() {\n                delete this.locale;\n                return this.locale = ADDMENU_LOCALE || \"en-US\";\n            },\n            get panelId() {\n                delete this.panelId;\n                return this.panelId = Math.floor(Math.random() * 900000 + 99999);\n            },\n            init: function () {\n                this.win = window;\n                // prepare regex\n                let he = \"(?:_HTML(?:IFIED)?|_ENCODE)?\";\n                let rTITLE = \"%TITLE\" + he + \"%|%t\\\\b\";\n                let rTITLES = \"%TITLES\" + he + \"%|%t\\\\b\";\n                let rURL = \"%(?:R?LINK_OR_)?URL\" + he + \"%|%u\\\\b\";\n                let rHOST = \"%HOST\" + he + \"%|%h\\\\b\";\n                let rSEL = \"%SEL\" + he + \"%|%s\\\\b\";\n                let rLINK = \"%R?LINK(?:_TEXT|_HOST)?\" + he + \"%|%l\\\\b\";\n                let rIMAGE = \"%IMAGE(?:_URL|_ALT|_TITLE)\" + he + \"%|%i\\\\b\";\n                let rIMAGE_BASE64 = \"%IMAGE_BASE64\" + he + \"%|%i\\\\b\";\n                let rSVG_BASE64 = \"%SVG_BASE64\" + he + \"%|%i\\\\b\";\n                let rMEDIA = \"%MEDIA_URL\" + he + \"%|%m\\\\b\";\n                let rCLIPBOARD = \"%CLIPBOARD\" + he + \"%|%p\\\\b\";\n                let rFAVICON = \"%FAVICON\" + he + \"%\";\n                let rEMAIL = \"%EMAIL\" + he + \"%\";\n                let rExt = \"%EOL\" + he + \"%\";\n\n                let rFAVICON_BASE64 = \"%FAVICON_BASE64\" + he + \"%\";\n                let rRLT_OR_UT = \"%RLT_OR_UT\" + he + \"%\"; // 链接文本或网页标题\n\n                this.rTITLE = new RegExp(rTITLE, \"i\");\n                this.rTITLES = new RegExp(rTITLES, \"i\");\n                this.rURL = new RegExp(rURL, \"i\");\n                this.rHOST = new RegExp(rHOST, \"i\");\n                this.rSEL = new RegExp(rSEL, \"i\");\n                this.rLINK = new RegExp(rLINK, \"i\");\n                this.rIMAGE = new RegExp(rIMAGE, \"i\");\n                this.rMEDIA = new RegExp(rMEDIA, \"i\");\n                this.rCLIPBOARD = new RegExp(rCLIPBOARD, \"i\");\n                this.rFAVICON = new RegExp(rFAVICON, \"i\");\n                this.rEMAIL = new RegExp(rEMAIL, \"i\");\n                this.rExt = new RegExp(rExt, \"i\");\n                this.rFAVICON_BASE64 = new RegExp(rFAVICON_BASE64, \"i\");\n                this.rIMAGE_BASE64 = new RegExp(rIMAGE_BASE64, \"i\");\n                this.rSVG_BASE64 = new RegExp(rSVG_BASE64, \"i\");\n                this.rRLT_OR_UT = new RegExp(rRLT_OR_UT, \"i\");\n\n                this.regexp = new RegExp(\n                    [rTITLE, rTITLES, rURL, rHOST, rSEL, rLINK, rIMAGE, rIMAGE_BASE64, rMEDIA, rSVG_BASE64, rCLIPBOARD, rFAVICON, rFAVICON_BASE64, rEMAIL, rExt, rRLT_OR_UT].join(\"|\"), \"ig\");\n\n                // add menuitem insertpoint\n                for (let type in MENU_ATTRS) {\n                    let ins = MENU_ATTRS[type].insRef;\n                    if (ins) {\n                        let tag = ins.localName.startsWith(\"menu\") ? \"menuseparator\" : \"toolbarseparator\";\n                        let insertPoint = $C(tag, {\n                            id: `addMenu-${type}-insertpoint`,\n                            class: \"addMenu-insert-point\",\n                            hidden: true\n                        })\n                        MENU_ATTRS[type].insertId = insertPoint.id;\n                        ins.parentNode.insertBefore(insertPoint, ins.nextSibling);\n                        delete MENU_ATTRS[type].insRef;\n                    } else {\n                        delete MENU_ATTRS[type];\n                    }\n                }\n\n                // old style groupmenu compatibility\n                MENU_ATTRS['group'] = {\n                    current: \"group\",\n                    submenu: \"GroupMenu\",\n                    insertId: \"addMenu-page-insertpoint\"\n                };\n\n                $(\"contentAreaContextMenu\").addEventListener(\"popupshowing\", this, false);\n                $(\"tabContextMenu\").addEventListener(\"popupshowing\", this, false);\n                $(\"toolbar-context-menu\").addEventListener(\"popupshowing\", this, false);\n                $(\"menu_FilePopup\").addEventListener(\"popupshowing\", this, false);\n                $(\"menu_ToolsPopup\").addEventListener(\"popupshowing\", this, false);\n\n                // move menuitems to Hamburger menu when firstly clicks the PanelUI button \n                PanelUI.mainView.addEventListener(\"ViewShowing\", this.moveToAppMenu, {\n                    once: true\n                });\n\n                // PanelUI 增加 CustomShowing 支持\n                PanelUI.mainView.addEventListener(\"ViewShowing\", this);\n\n                this.APP_LITENER_REMOVER = function () {\n                    PanelUI.mainView.removeEventListener(\"ViewShowing\", this);\n                }\n\n                this.identityBox = $('identity-icon') || $('identity-box')\n                if (enableidentityBoxContextMenu && this.identityBox) {\n                    // SSL 小锁右键菜单\n                    this.identityBox.addEventListener(\"click\", this, false);\n                    this.identityBox.setAttribute('contextmenu', false);\n                    var popup = $(\"mainPopupSet\").appendChild($C('menupopup', {\n                        id: 'identity-box-contextmenu'\n                    }));\n                    popup.appendChild($C(\"menuseparator\", {\n                        id: \"addMenu-identity-insertpoint\",\n                        class: \"addMenu-insert-point\",\n                        hidden: true\n                    }));\n                    $(\"mainPopupSet\").appendChild(popup);\n                    MENU_ATTRS['ident'] = {\n                        current: \"ident\",\n                        submenu: \"IdentMenu\",\n                        groupmenu: \"IdentGroup\",\n                        insertId: 'addMenu-identity-insertpoint'\n                    }\n                }\n\n                // 增加工具菜单\n                var ins = $(\"devToolsSeparator\");\n                ins.parentNode.insertBefore($C(\"menuitem\", {\n                    id: \"addMenu-rebuild\",\n                    label: $L('addmenuplus label'),\n                    tooltiptext: $L('addmenuplus tooltip'),\n                    oncommand: \"setTimeout(function(){ addMenu.rebuild(true); }, 10);\",\n                    onclick: \"if (event.button == 2) { event.preventDefault(); addMenu.edit(addMenu.FILE); }\",\n                }), ins);\n\n                // Photon Compact\n                if (enableContentAreaContextMenuCompact)\n                    $(\"contentAreaContextMenu\").setAttribute(\"photoncompact\", \"true\");\n\n                // 响应鼠标键释放事件（eg：获取选中文本）\n                (gBrowser.mPanelContainer || gBrowser.tabpanels).addEventListener(\"mouseup\", this, false);\n\n                // 响应标签修改事件\n                gBrowser.tabContainer.addEventListener('TabAttrModified', this);\n\n                this.style = addStyle(css);\n                this.rebuild();\n            },\n            destroy: function () {\n                ChromeUtils.unregisterWindowActor('AddMenu');\n                $(\"contentAreaContextMenu\").removeEventListener(\"popupshowing\", this, false);\n                $(\"tabContextMenu\").removeEventListener(\"popupshowing\", this, false);\n                $(\"toolbar-context-menu\").removeEventListener(\"popupshowing\", this, false);\n                $(\"menu_FilePopup\").removeEventListener(\"popupshowing\", this, false);\n                $(\"menu_ToolsPopup\").removeEventListener(\"popupshowing\", this, false);\n                $(\"contentAreaContextMenu\").removeAttribute(\"photoncompact\");\n                if (typeof this.APP_LITENER_REMOVER === \"function\")\n                    this.APP_LITENER_REMOVER();\n                (gBrowser.mPanelContainer || gBrowser.tabpanels).removeEventListener(\"mouseup\", this, false);\n                gBrowser.tabContainer.removeEventListener('TabAttrModified', this);\n                this.removeMenuitem();\n                $$('#addMenu-rebuild, .addMenu-insert-point').forEach(function (e) {\n                    e.parentNode.removeChild(e)\n                });\n                if ($('identity-box-contextmenu')) {\n                    var popup = $('identity-box-contextmenu');\n                    popup.parentNode.removeChild(popup);\n                }\n                if (this.identityBox) {\n                    this.identityBox.removeAttribute('contextmenu');\n                    this.identityBox.removeEventListener(\"click\", this, false);\n                }\n                if (this.style && this.style.parentNode) this.style.parentNode.removeChild(this.style);\n                if (this.style2 && this.style2.parentNode) this.style2.parentNode.removeChild(this.style2);\n                delete window.addMenu;\n            },\n            handleEvent: function (event) {\n                switch (event.type) {\n                    case \"ViewShowing\":\n                    case \"popupshowing\":\n                        if (event.target != event.currentTarget) return;\n                        if (enableFileRefreshing) {\n                            this.updateModifiedFile();\n                        }\n\n                        event.target.querySelectorAll(`.addMenu`).forEach(m => {\n                            // 强制去除隐藏属性\n                            m.removeAttribute(\"hidden\");\n                            // 显示时自动更新标签\n                            if (m.hasAttribute('onshowinglabel')) {\n                                onshowinglabelMaxLength = onshowinglabelMaxLength || 15;\n                                var sel = addMenu.convertText(m.getAttribute('onshowinglabel'))\n                                if (sel && sel.length > 15)\n                                    sel = sel.substr(0, 15) + \"...\";\n                                m.setAttribute('label', sel);\n                            }\n                        });\n\n                        let insertPoint = \"\";\n\n                        if (event.target.id == 'contentAreaContextMenu') {\n                            var state = [];\n                            if (gContextMenu.onTextInput)\n                                state.push(\"input\");\n                            if (gContextMenu.isContentSelected || gContextMenu.isTextSelected)\n                                state.push(\"select\");\n                            if (gContextMenu.onLink || event.target.querySelector(\"#context-openlinkincurrent\").getAttribute(\"hidden\") !== \"true\")\n                                state.push(gContextMenu.onMailtoLink ? \"mailto\" : \"link\");\n                            if (gContextMenu.onCanvas)\n                                state.push(\"canvas image\");\n                            if (gContextMenu.onImage)\n                                state.push(\"image\");\n                            if (gContextMenu.onVideo || gContextMenu.onAudio)\n                                state.push(\"media\");\n                            event.currentTarget.setAttribute(\"addMenu\", state.join(\" \"));\n\n                            insertPoint = \"addMenu-page-insertpoint\";\n                        }\n\n                        if (event.target.id === \"toolbar-context-menu\") {\n                            let triggerNode = event.target.triggerNode;\n                            var state = [];\n                            const map = {\n                                'toolbar-menubar': 'menubar',\n                                'TabsToolbar': 'tabs',\n                                'nav-bar': 'navbar',\n                                'PersonalToolbar': 'personal',\n                            }\n                            Object.keys(map).map(e => $(e).contains(triggerNode) && state.push(map[e]));\n                            if (triggerNode && triggerNode.localName === \"toolbarbutton\") {\n                                state.push(\"button\");\n                            }\n                            event.currentTarget.setAttribute(\"addMenu\", state.join(\" \"));\n\n                            insertPoint = \"addMenu-nav-insertpoint\";\n                        }\n\n                        if (event.target.id === \"tabContextMenu\") {\n                            insertPoint = \"addMenu-tab-insertpoint\";\n                        }\n\n                        if (event.target.id === \"identity-box-contextmenu\") {\n                            insertPoint = \"addMenu-identity-insertpoint\";\n                        }\n\n                        if (event.target.id === \"menu_FilePopup\" || event.target.id === \"appMenu-protonMainView\") {\n                            insertPoint = \"addMenu-app-insertpoint\";\n                        }\n\n                        if (event.target.id === \"menu_ToolsPopup\") {\n                            insertPoint = \"addMenu-tool-insertpoint\";\n                        }\n\n                        this.customShowings.filter(obj => obj.insertPoint === insertPoint).forEach(function (obj) {\n                            var curItem = obj.item;\n                            try {\n                                eval('(' + obj.fnSource + ').call(curItem, curItem)');\n                            } catch (ex) {\n                                console.error($L('custom showing method error'), obj.fnSource, ex);\n                            }\n                        });\n\n                        break;\n                    case 'mouseup':\n                        // get selected text\n                        if (content) {\n                            // 内置页面\n                            this.setSelectedText(BrowserOrSelectionUtils.getSelectionDetails(content).fullText);\n                        } else {\n                            // 网页\n                            let actor = gBrowser.selectedBrowser.browsingContext.currentWindowGlobal.getActor(\"AddMenu\");\n                            actor.sendAsyncMessage(\"AM:GetSelectedText\", {});\n                        }\n                        break;\n                    case 'click':\n                        if (event.button == 2 && event.target.id === this.identityBox.id)\n                            $(\"identity-box-contextmenu\").openPopup(event.target, \"after_pointer\", 0, 0, true, false);\n\n                        break;\n                    case 'TabAttrModified':\n                        let tab = event.target;\n                        if (content) return;\n                        if (typeof tab === \"undefined\")\n                            return;\n                        try {\n                            let hash = calculateHashFromStr(tab.linkedBrowser.currentURI.spec)\n                            tab.faviconHash = hash;\n                            let actor = tab.linkedBrowser.browsingContext.currentWindowGlobal.getActor(\"AddMenu\");\n                            actor.sendAsyncMessage(\"AM:GetFaviconLink\", { hash: hash });\n                        } catch (error) { }\n                        break;\n                }\n                function calculateHashFromStr(data) {\n                    // Lazily create a reusable hasher\n                    let gCryptoHash = Cc[\"@mozilla.org/security/hash;1\"].createInstance(\n                        Ci.nsICryptoHash\n                    );\n\n                    gCryptoHash.init(gCryptoHash.MD5);\n\n                    // Convert the data to a byte array for hashing\n                    gCryptoHash.update(\n                        data.split(\"\").map(c => c.charCodeAt(0)),\n                        data.length\n                    );\n                    // Request the has result as ASCII base64\n                    return gCryptoHash.finish(true);\n                }\n\n            },\n            updateModifiedFile: function () {\n                if (!this.FILE.exists()) return;\n\n                if (this._modifiedTime != this.FILE.lastModifiedTime) {\n                    this._modifiedTime = this.FILE.lastModifiedTime;\n\n                    setTimeout(function () {\n                        addMenu.rebuild(true);\n                    }, 10);\n                }\n            },\n            onCommand: function (event) {\n                var menuitem = event.target;\n                var text = menuitem.getAttribute(\"text\") || \"\";\n                var keyword = menuitem.getAttribute(\"keyword\") || \"\";\n                var url = menuitem.getAttribute(\"url\") || \"\";\n                var where = menuitem.getAttribute(\"where\") || \"\";\n                var exec = menuitem.getAttribute(\"exec\") || \"\";\n\n                if (keyword) {\n                    let param = (text ? (text = this.convertText(text)) : \"\");\n                    let engine = keyword === \"@default\" ? Services.search.getDefault() : Services.search.getEngineByAlias(keyword);\n                    if (engine) {\n                        if (isPromise(engine)) {\n                            engine.then(function (engine) {\n                                let submission = engine.getSubmission(param);\n                                addMenu.openCommand(event, submission.uri.spec, where);\n                            });\n                        } else {\n                            let submission = engine.getSubmission(param);\n                            this.openCommand(event, submission.uri.spec, where);\n                        }\n                    } else {\n                        PlacesUtils.keywords.fetch(keyword || '').then(entry => {\n                            if (!entry) return;\n                            // 文字化けの心配が…\n                            let newurl = entry.url.href.replace('%s', encodeURIComponent(param));\n                            this.openCommand(event, newurl, where);\n                        });\n                    }\n                } else if (url)\n                    this.openCommand(event, this.convertText(url), where);\n                else if (exec)\n                    this.exec(exec, this.convertText(text));\n                else if (text)\n                    this.copy(this.convertText(text));\n            },\n            openCommand: function (event, url, where, postData) {\n                var uri;\n                try {\n                    uri = Services.io.newURI(url, null, null);\n                } catch (e) {\n                    return this.log(U($L('url is invalid')).replace(\"%s\", url));\n                }\n                if (uri.scheme === \"javascript\") {\n                    this.loadURI(url);\n                } else if (where) {\n                    if (this.appVersion < 78) {\n                        openUILinkIn(uri.spec, where, false, postData || null);\n                    } else {\n                        openWebLinkIn(uri.spec, where, {\n                            postData: postData || null,\n                            triggeringPrincipal: where === 'current' ?\n                                gBrowser.selectedBrowser.contentPrincipal : (\n                                    /^(f|ht)tps?:/.test(uri.spec) ?\n                                        Services.scriptSecurityManager.createNullPrincipal({\n                                            userContextId: gBrowser.selectedBrowser.getAttribute(\n                                                \"userContextId\"\n                                            )\n                                        }) :\n                                        Services.scriptSecurityManager.getSystemPrincipal()\n                                )\n                        });\n                    }\n                } else if (event.button == 1) {\n                    if (this.appVersion < 78) {\n                        openUILinkIn(uri.spec, 'tab');\n                    } else {\n                        openWebLinkIn(uri.spec, 'tab', {\n                            triggeringPrincipal: /^(f|ht)tps?:/.test(uri.spec) ?\n                                Services.scriptSecurityManager.createNullPrincipal({\n                                    userContextId: gBrowser.selectedBrowser.getAttribute(\n                                        \"userContextId\"\n                                    )\n                                }) : Services.scriptSecurityManager.getSystemPrincipal()\n                        });\n                    }\n                } else {\n                    // 参数 3 aIgnoreButton 允许 bool 和 Object，如果是 Object，则会用作 params 参数\n                    openUILink(uri.spec, event, {\n                        triggeringPrincipal: Services.scriptSecurityManager.getSystemPrincipal()\n                    });\n                }\n            },\n            loadURI: function (url) {\n                if (\"loadURI\" in window) {\n                    var loadURI = (url) => {\n                        gBrowser.loadURI(url instanceof Ci.nsIURI ? url.spec : url, { triggeringPrincipal: gBrowser.contentPrincipal });\n                    }\n                } else {\n                    var loadURI = (url) => {\n                        try {\n                            gBrowser.loadURI(url instanceof Ci.nsIURI ? url : Services.io.newURI(url, null, null), { triggeringPrincipal: gBrowser.contentPrincipal });\n                        } catch (ex) {\n                            console.error(ex);\n                        }\n                    }\n                }\n                (this.loadURI = loadURI)(url);\n            },\n            openUILinkIn: function (url, where, aAllowThirdPartyFixup, aPostData, aReferrerInfo) {\n                const createFixUp = (url, where, aAllowThirdPartyFixup, aPostData, aReferrerInfo) => {\n                    aAllowThirdPartyFixup = aAllowThirdPartyFixup instanceof Object ? aAllowThirdPartyFixup : {};\n                    aAllowThirdPartyFixup.triggeringPrincipal = aAllowThirdPartyFixup.triggeringPrincipal || (where === 'current' ? gBrowser.selectedBrowser.contentPrincipal : (\n                        /^(f|ht)tps?:/.test(url) ?\n                            Services.scriptSecurityManager.createNullPrincipal({}) :\n                            Services.scriptSecurityManager.getSystemPrincipal()\n                    ));\n                    aAllowThirdPartyFixup.postData = aPostData || null;\n                    aAllowThirdPartyFixup.referrerInfo = aReferrerInfo || null;\n                }\n                if (\"openTrustedLinkIn\" in window) {\n                    var _openURL = (url, where, aAllowThirdPartyFixup, aPostData, aReferrerInfo) => {\n                        openTrustedLinkIn(url, where, createFixUp(url, where, aAllowThirdPartyFixup, aPostData, aReferrerInfo));\n                    }\n                } else {\n                    var _openURL = (url, where, aAllowThirdPartyFixup, aPostData, aReferrerInfo) =>\n                        openUILinkIn(url, where, false, aPostData || null, aReferrerInfo);\n                }\n                (this.openUILinkIn = _openURL)(url, where, aAllowThirdPartyFixup, aPostData, aReferrerInfo);\n            },\n            exec: function (path, arg) {\n                var file = Cc['@mozilla.org/file/local;1'].createInstance(Ci.nsIFile);\n                var process = Cc['@mozilla.org/process/util;1'].createInstance(Ci.nsIProcess);\n                try {\n                    var a;\n                    if (typeof arg == \"undefined\") arg = []; // fix slice error\n                    if (typeof arg == 'string' || arg instanceof String) {\n                        a = arg.split(/\\s+/)\n                    } else if (Array.isArray(arg)) {\n                        a = arg;\n                    } else {\n                        a = [arg];\n                    }\n\n                    file.initWithPath(path);\n                    if (!file.exists()) {\n                        Cu.reportError($L(\"file not found\", path));\n                        return;\n                    }\n\n                    // Linux 下目录也是 executable\n                    if (!file.isDirectory() && file.isExecutable()) {\n                        process.init(file);\n                        process.runw(false, a, a.length);\n                    } else {\n                        file.launch();\n                    }\n                } catch (e) {\n                    this.log(e);\n                }\n            },\n            handleRelativePath: function (path, parentPath) {\n                if (path) {\n                    var ffdir = parentPath ? parentPath : Cc['@mozilla.org/file/directory_service;1'].getService(Ci.nsIProperties).get(\"ProfD\", Ci.nsIFile).path;\n                    // windows 的目录分隔符不一样\n                    if (this.platform === \"win\") {\n                        path = path.replace(/\\//g, '\\\\');\n                        if (/^(\\\\)/.test(path)) {\n                            return ffdir + path;\n                        }\n                    } else {\n                        path = path.replace(/\\\\/g, '//');\n                        if (/^(\\/\\/)/.test(path)) {\n                            return ffdir + path.replace(/^\\/\\//, \"/\");\n                        }\n                    }\n                    return path;\n                }\n            },\n            moveToAppMenu: async function (_e) {\n                let ins = document.getElementById('addMenu-app-insertpoint');\n                if (ins && ins.localName === 'menuseparator') {\n                    let separator = $('appMenu-quit-button2').previousSibling;\n                    if (separator) {\n                        ins.remove();\n                        // addMenu.removeMenuitem();\n                        ins = $C('toolbarseparator', {\n                            'id': 'addMenu-app-insertpoint',\n                            class: \"addMenu-insert-point\",\n                            hidden: true\n                        });\n                        separator.parentNode.insertBefore(ins, separator);\n                        addMenu.rebuild();\n                    }\n                }\n            },\n            rebuild: function (isAlert) {\n                var aFile = this.FILE;\n\n                if (!aFile || !aFile.exists() || !aFile.isFile()) {\n                    this.log(aFile ? aFile.path : U($L('config file')) + U($L('not exists')));\n                    return;\n                }\n\n                var data = loadText(aFile);\n\n                var sandbox = new Cu.Sandbox(new XPCNativeWrapper(window));\n\n                sandbox.Components = Components;\n                sandbox.Cc = Cc;\n                sandbox.Ci = Ci;\n                sandbox.Cr = Cr;\n                sandbox.Cu = Cu;\n                sandbox.Services = Services;\n                sandbox.locale = this.locale;\n                sandbox.addMenu = this;\n                sandbox.$L = $L;\n\n                var includeSrc = \"\";\n                sandbox.include = function (aLeafName) {\n                    var data = loadFile(aLeafName);\n                    if (data)\n                        includeSrc += data + \"\\n\";\n                };\n                sandbox._css = [];\n\n                Object.values(MENU_ATTRS).forEach(function ({\n                    current,\n                    submenu,\n                    groupmenu\n                }) {\n                    sandbox[\"_\" + current] = [];\n                    if (submenu !== \"GroupMenu\") {\n                        sandbox[current] = function (itemObj) {\n                            ps(itemObj, sandbox[\"_\" + current]);\n                        }\n                    }\n                    sandbox[submenu] = function (menuObj) {\n                        if (!menuObj)\n                            menuObj = {};\n                        menuObj._items = [];\n                        if (submenu == 'GroupMenu')\n                            menuObj._group = true;\n                        sandbox[\"_\" + current].push(menuObj);\n                        return function (itemObj) {\n                            ps(itemObj, menuObj._items);\n                        }\n                    }\n                    if (isDef(groupmenu))\n                        sandbox[groupmenu] = function (menuObj) {\n                            if (!menuObj)\n                                menuObj = {};\n                            menuObj._items = [];\n                            menuObj._group = true;\n                            sandbox[\"_\" + current].push(menuObj);\n                            return function (itemObj) {\n                                ps(itemObj, menuObj._items);\n                            }\n                        }\n                }, this);\n\n                function ps(item, array) {\n                    (\"join\" in item && \"unshift\" in item) ? [].push.apply(array, item) :\n                        array.push(item);\n                }\n\n                try {\n                    var lineFinder = new Error();\n                    Cu.evalInSandbox(\"function css(code){ this._css.push(code+'') };\\n\" + data, sandbox, \"1.8\");\n                    Cu.evalInSandbox(includeSrc, sandbox, \"1.8\");\n                } catch (e) {\n                    let line = e.lineNumber - lineFinder.lineNumber - 1;\n                    this.alert(e + $L(\"check config file with line\", line), null, function () {\n                        addMenu.edit(addMenu.FILE, line);\n                    });\n                    return this.log(e);\n                }\n                if (this.style2 && this.style2.parentNode)\n                    this.style2.parentNode.removeChild(this.style2);\n                if (sandbox._css.length)\n                    this.style2 = addStyle(sandbox._css.join(\"\\n\"));\n\n                this.removeMenuitem();\n\n                this.customShowings = [];\n                this.customFrameResult = [];\n\n                Object.values(MENU_ATTRS).forEach(function ({\n                    current,\n                    submenu,\n                    groupmenu,\n                    insertId\n                }) {\n                    if (!sandbox[\"_\" + current] || sandbox[\"_\" + current].length == 0) return;\n                    let insertPoint = $(insertId);\n                    this.createMenuitem(sandbox[\"_\" + current], insertPoint);\n                }, this);\n\n\n                if (isAlert) this.alert(U($L('config has reload')));\n            },\n            newGroupMenu: function (menuObj, opt) {\n                var group = $C('menugroup');\n\n                // 增加 onshowing 事件\n                if (menuObj.onshowing) {\n                    this.customShowings.push({\n                        item: group,\n                        insertPoint: opt.insertPoint.id,\n                        fnSource: menuObj.onshowing\n                    });\n                    delete menuObj.onshowing;\n                }\n\n                if (menuObj.framescript) {\n                    if (typeof menuObj.framescript === \"function\") {\n                        menuObj.framescript = menuObj.framescript.toString();\n                    } else if (menuObj.framescript.keyword && menuObj.framescript.result && menuObj.framescript.script) {\n                        this.customFrameResult.push({\n                            keyword: menuObj.framescript.keyword,\n                            result: menuObj.framescript.result,\n                        })\n                        if (typeof menuObj.framescript.script === \"function\") {\n                            menuObj.framescript = menuObj.framescript.script.toString();\n                        }\n                    }\n                    menuObj.framescript = btoa(encodeURIComponent(menuObj.framescript));\n                }\n\n                Object.keys(menuObj).map(function (key) {\n                    var val = menuObj[key];\n                    if (key === \"_items\") return;\n                    if (key === \"_group\") return;\n                    if (typeof val == \"function\")\n                        menuObj[key] = val = \"(\" + val.toString() + \").call(this, event);\";\n                    group.setAttribute(key, val);\n                }, this);\n                let cls = group.classList;\n                cls.add('addMenu');\n\n                // 表示 / 非表示の設定\n                if (menuObj.condition) {\n                    this.setCondition(group, menuObj.condition);\n                    // Sync condition attribute to child menus\n                    menuObj._items.forEach(function (obj) {\n                        if (!Object.keys(obj).includes(\"contidion\")) {\n                            obj.condition = menuObj.condition;\n                        }\n                    });\n                }\n\n                menuObj._items.forEach(function (obj) {\n                    group.appendChild(this.newMenuitem(obj, {\n                        isMenuGroup: true\n                    }));\n                }, this);\n                return group;\n            },\n            newMenu: function (menuObj, opt) {\n                opt || (opt = {});\n                if (menuObj._group) {\n                    return this.newGroupMenu(menuObj, opt);\n                }\n                var isAppMenu = opt.insertPoint && opt.insertPoint.localName === \"toolbarseparator\" && opt.insertPoint.id === 'addMenu-app-insertpoint',\n                    separatorType = isAppMenu ? \"toolbarseparator\" : \"menuseparator\",\n                    menuitemType = isAppMenu ? \"toolbarbutton\" : \"menu\",\n                    menu = $C(menuitemType),\n                    popup,\n                    panelId;\n\n                // fix for appmenu\n                const viewCache = ($('appMenu-viewCache') && $('appMenu-viewCache').content) || $('appMenu-multiView');\n                if (isAppMenu && viewCache) {\n                    menu.setAttribute('closemenu', \"none\");\n                    panelId = menuObj.id ? menuObj.id + \"-panel\" : \"addMenu-panel-\" + this.panelId++;\n                    popup = viewCache.appendChild($C('panelview', {\n                        'id': panelId,\n                        'class': 'addMenu PanelUI-subView'\n                    }));\n                    popup = popup.appendChild($C('vbox', {\n                        class: 'panel-subview-body',\n                        panelId: panelId\n                    }));\n                } else {\n                    popup = menu.appendChild($C(\"menupopup\"));\n                }\n\n                if (menuObj.onshowing) {\n                    this.customShowings.push({\n                        item: menu,\n                        insertPoint: opt.insertPoint.id,\n                        fnSource: menuObj.onshowing.toString()\n                    });\n                    delete menuObj.onshowing;\n                }\n\n                if (menuObj.framescript) {\n                    if (typeof menuObj.framescript === \"function\") {\n                        menuObj.framescript = menuObj.framescript.toString();\n                    } else if (menuObj.framescript.keyword && menuObj.framescript.result && menuObj.framescript.script) {\n                        this.customFrameResult.push({\n                            keyword: menuObj.framescript.keyword,\n                            result: menuObj.framescript.result,\n                        })\n                        if (typeof menuObj.framescript.script === \"function\") {\n                            menuObj.framescript = menuObj.framescript.script.toString();\n                        }\n                    }\n                    menuObj.framescript = btoa(encodeURIComponent(menuObj.framescript));\n                }\n\n                for (let key in menuObj) {\n                    let val = menuObj[key];\n                    if (key === \"_items\") continue;\n                    if (typeof val == \"function\")\n                        menuObj[key] = val = \"(\" + val.toString() + \").call(this, event);\"\n                    menu.setAttribute(key, val);\n\n                }\n\n                let cls = menu.classList;\n                cls.add(\"addMenu\");\n                if (isAppMenu) {\n                    cls.add(\"subviewbutton\");\n                    cls.add(\"subviewbutton-nav\");\n                } else {\n                    cls.add(\"menu-iconic\");\n                }\n\n\n                // 表示 / 非表示の設定\n                if (menuObj.condition)\n                    this.setCondition(menu, menuObj.condition);\n\n                menuObj._items.forEach(function (obj) {\n                    popup.appendChild(this.newMenuitem(obj, opt));\n                }, this);\n\n                // menu に label が無い場合、最初の menuitem の label 等を持ってくる\n                // menu 部分をクリックで実行できるようにする(splitmenu みたいな感じ)\n                if (isAppMenu) {\n                    menu.setAttribute('oncommand', `PanelUI.showSubView('${panelId}', this)`);\n                } else if (!menu.hasAttribute('label')) {\n                    let firstItem = menu.querySelector('menuitem');\n                    if (firstItem) {\n                        let command = firstItem.getAttribute('command');\n                        if (command)\n                            firstItem = document.getElementById(command) || firstItem;\n                        ['label', 'accesskey', 'image', 'icon'].forEach(function (n) {\n                            if (!menu.hasAttribute(n) && firstItem.hasAttribute(n))\n                                menu.setAttribute(n, firstItem.getAttribute(n));\n                        }, this);\n                        menu.setAttribute('onclick', \"\\\n                        if (event.target != event.currentTarget) return;\\\n                        var firstItem = event.currentTarget.querySelector('menuitem');\\\n                        if (!firstItem) return;\\\n                        if (event.button === 1) {\\\n                            checkForMiddleClick(firstItem, event);\\\n                        } else {\\\n                            firstItem.doCommand();\\\n                            closeMenus(event.currentTarget);\\\n                        }\\\n                    \");\n                    }\n                }\n                return menu;\n            },\n            newMenuitem: function (obj, opt) {\n                opt || (opt = {});\n\n                var menuitem,\n                    isAppMenu = opt.insertPoint && opt.insertPoint.localName === \"toolbarseparator\" && opt.insertPoint.id === 'addMenu-app-insertpoint',\n                    separatorType = isAppMenu ? \"toolbarseparator\" : \"menuseparator\",\n                    menuitemType = isAppMenu ? \"toolbarbutton\" : \"menuitem\",\n                    noDefaultLabel = false;\n\n                // label == separator か必要なプロパティが足りない場合は区切りとみなす\n                if (obj.label === \"separator\" ||\n                    (!obj.label && !obj.image && !obj.text && !obj.keyword && !obj.url && !obj.oncommand && !obj.command)) {\n                    menuitem = $C(separatorType);\n                } else if (obj.oncommand || obj.command) {\n                    let org = obj.command ? document.getElementById(obj.command) : null;\n                    if (org && org.localName === separatorType) {\n                        menuitem = $C(separatorType);\n                    } else {\n                        menuitem = $C(menuitemType);\n                        if (obj.command)\n                            menuitem.setAttribute(\"command\", obj.command);\n\n                        noDefaultLabel = !obj.label;\n                        if (noDefaultLabel)\n                            obj.label = obj.command || obj.oncommand;\n                    }\n                } else {\n                    menuitem = $C(menuitemType);\n\n                    // property fix\n                    noDefaultLabel = !obj.label;\n                    if (noDefaultLabel)\n                        obj.label = obj.exec || obj.keyword || obj.url || obj.text;\n\n                    if (obj.keyword && !obj.text) {\n                        let index = obj.keyword.search(/\\s+/);\n                        if (index > 0) {\n                            obj.text = obj.keyword.substr(index).trim();\n                            obj.keyword = obj.keyword.substr(0, index);\n                        }\n                    }\n\n                    if (obj.where && /\\b(tab|tabshifted|window|current)\\b/i.test(obj.where))\n                        obj.where = RegExp.$1.toLowerCase();\n\n                    if (obj.where && !(\"acceltext\" in obj))\n                        obj.acceltext = obj.where;\n\n                    if (!obj.condition && (obj.url || obj.text)) {\n                        // 表示 / 非表示の自動設定\n                        let condition = \"\";\n                        if (this.rSEL.test(obj.url || obj.text)) condition += \" select\";\n                        if (this.rLINK.test(obj.url || obj.text)) condition += \" link\";\n                        if (this.rEMAIL.test(obj.url || obj.text)) condition += \" mailto\";\n                        if (this.rIMAGE.test(obj.url || obj.text)) condition += \" image\";\n                        if (this.rMEDIA.test(obj.url || obj.text)) condition += \" media\";\n                        if (condition)\n                            obj.condition = condition;\n                    }\n\n                    if (obj.exec) {\n                        obj.exec = this.handleRelativePath(obj.exec);\n                    }\n                }\n\n                // 右键第一层菜单添加 onpopupshowing 事件\n                if (opt.isTopMenuitem && obj.onshowing) {\n                    this.customShowings.push({\n                        item: menuitem,\n                        insertPoint: opt.insertPoint.id,\n                        fnSource: obj.onshowing.toString()\n                    });\n                    delete obj.onshowing;\n                }\n\n                if (obj.framescript) {\n                    if (typeof obj.framescript === \"function\") {\n                        obj.framescript = obj.framescript.toString();\n                    } else if (obj.framescript.keyword && obj.framescript.result && obj.framescript.script) {\n                        this.customFrameResult.push({\n                            keyword: obj.framescript.keyword,\n                            result: obj.framescript.result,\n                        })\n                        if (typeof obj.framescript.script === \"function\") {\n                            obj.framescript = obj.framescript.script.toString();\n                        }\n                    }\n                    obj.framescript = btoa(encodeURIComponent(obj.framescript));\n                }\n\n                for (let key in obj) {\n                    let val = obj[key];\n                    if (key === \"command\") continue;\n                    if (typeof val == \"function\")\n                        obj[key] = val = \"(\" + val.toString() + \").call(this, event);\";\n                    menuitem.setAttribute(key, val);\n                }\n\n                if (noDefaultLabel && menuitem.localName !== separatorType) {\n                    if (this.supportLocalization && obj['data-l10n-href'] && obj[\"data-l10n-href\"].endsWith(\".ftl\") && obj['data-l10n-id']) {\n                        // Localization 支持\n                        let strings = new Localization([obj[\"data-l10n-href\"]]);\n                        strings.formatValue([obj['data-l10n-id']]).then(\n                            text => {\n                                menuitem.setAttribute('label', text || menuitem.getAttribute(\"label\"));\n                            }\n                        )\n                    } else if (obj.keyword) {\n                        // 调用搜索引擎 Label hack\n                        let engine = obj.keyword === \"@default\" ? Services.search.getDefault() : Services.search.getEngineByAlias(obj.keyword);\n                        if (isPromise(engine)) {\n                            engine.then(s => {\n                                if (s && s._name) menuitem.setAttribute('label', s._name);\n                            });\n                        } else {\n                            if (engine && engine._name) menuitem.setAttribute('label', engine._name);\n                        }\n                    }\n                }\n\n                /** obj を属性にする\n                 for (let [key, val] in Iterator(obj)) {\n                if (key === \"command\") continue;\n                if (typeof val == \"function\")\n                    obj[key] = val = \"(\" + val.toString() + \").call(this, event);\";\n                    menuitem.setAttribute(key, val);\n                }**/\n\n                var cls = menuitem.classList;\n                cls.add(\"addMenu\");\n\n                if (isAppMenu) {\n                    if (menuitem.localName == \"toolbarbutton\") cls.add(\"subviewbutton\");\n                } else {\n                    cls.add(\"menuitem-iconic\");\n                }\n                // 表示 / 非表示の設定\n                if (obj.condition)\n                    this.setCondition(menuitem, obj.condition);\n\n                // separator はここで終了\n                if (menuitem.localName == \"menuseparator\")\n                    return menuitem;\n\n                if (!obj.onclick)\n                    menuitem.setAttribute(\"onclick\", \"checkForMiddleClick(this, event)\");\n\n                // 给 MenuGroup 的菜单加上 tooltiptext\n                if (opt.isMenuGroup && !obj.tooltiptext && obj.label) {\n                    menuitem.setAttribute('tooltiptext', obj.label);\n                }\n\n                // oncommand, command はここで終了\n                if (obj.oncommand || obj.command)\n                    return menuitem;\n\n                menuitem.setAttribute(\"oncommand\", \"addMenu.onCommand(event);\");\n\n                // 可能ならばアイコンを付ける\n                this.setIcon(menuitem, obj);\n\n                return menuitem;\n            },\n            createMenuitem: function (itemArray, insertPoint) {\n                var chldren = $A(insertPoint.parentNode.children);\n                //Symbol.iterator\n                for (let obj of itemArray) {\n                    if (!obj) continue;\n                    let menuitem;\n\n                    // clone menuitem and set attribute\n                    if (obj.id && (menuitem = $(obj.id))) {\n                        let dupMenuitem;\n                        let isDupMenu = (obj.clone != false);\n                        if (isDupMenu) {\n                            dupMenuitem = menuitem.cloneNode(true);\n\n                            // 隐藏原菜单\n                            // menuitem.classList.add(\"addMenuHide\");\n                        } else {\n                            dupMenuitem = menuitem;\n                            // 增加用于还原已移动菜单的标记\n                            if (dupMenuitem)\n                                dupMenuitem.parentNode.insertBefore($C(insertPoint.localName, {\n                                    'original-id': dupMenuitem.getAttribute('id'),\n                                    hidden: true,\n                                    class: 'addMenuOriginal',\n                                }), dupMenuitem);\n                        }\n                        if (obj.framescript) {\n                            if (typeof obj.framescript === \"function\") {\n                                obj.framescript = obj.framescript.toString();\n                            } else if (obj.framescript.keyword && obj.framescript.result && obj.framescript.script) {\n                                this.customFrameResult.push({\n                                    keyword: obj.framescript.keyword,\n                                    result: obj.framescript.result,\n                                })\n                                if (typeof obj.framescript.script === \"function\") {\n                                    obj.framescript = obj.framescript.script.toString();\n                                }\n                            }\n                            obj.framescript = btoa(encodeURIComponent(obj.framescript));\n                        }\n                        for (let key in obj) {\n                            let val = obj[key];\n                            if (typeof val == \"function\")\n                                obj[key] = val = \"(\" + val.toString() + \").call(this, event);\";\n\n                            dupMenuitem.setAttribute(key, val);\n\n                        }\n\n                        // 如果没有则添加 menuitem-iconic 或 menu-iconic，给菜单添加图标用。\n                        let type = dupMenuitem.nodeName,\n                            cls = dupMenuitem.classList;\n                        if (type == 'menuitem' || type == 'menu')\n                            if (!cls.contains(type + '-iconic'))\n                                cls.add(type + '-iconic');\n\n                        if (!cls.contains('addMenu'))\n                            cls.add('addMenu');\n                        if (!isDupMenu && !cls.contains('addMenuNot'))\n                            cls.add('addMenuNot');\n\n                        // // 没有插入位置的默认放在原来那个菜单的后面\n                        // if(isDupMenu && !obj.insertAfter && !obj.insertBefore && !obj.position){\n                        //     obj.insertAfter = obj.id;\n                        // }\n                        let noMove = !isDupMenu;\n                        insertMenuItem(obj, dupMenuitem, noMove);\n                        continue;\n                    }\n\n                    menuitem = obj._items ? this.newMenu(obj, {\n                        insertPoint: insertPoint\n                    }) : this.newMenuitem(obj, {\n                        isTopMenuitem: true,\n                        insertPoint: insertPoint\n                    });\n\n                    insertMenuItem(obj, menuitem);\n\n                }\n\n                function insertMenuItem(obj, menuitem, noMove) {\n                    let ins;\n                    if (obj.parent && (ins = $(obj.parent))) {\n                        ins.appendChild(menuitem);\n                        return;\n                    }\n                    if (obj.insertAfter && (ins = $(obj.insertAfter))) {\n                        ins.parentNode.insertBefore(menuitem, ins.nextSibling);\n                        return;\n                    }\n                    if (obj.insertBefore && (ins = $(obj.insertBefore))) {\n                        ins.parentNode.insertBefore(menuitem, ins);\n                        return;\n                    }\n                    if (obj.position && parseInt(obj.position, 10) > 0) {\n                        (ins = chldren[parseInt(obj.position, 10) - 1]) ?\n                            ins.parentNode.insertBefore(menuitem, ins) :\n                            insertPoint.parentNode.appendChild(menuitem);\n                        return;\n                    }\n                    if (!noMove) {\n                        insertPoint.parentNode.insertBefore(menuitem, insertPoint);\n                    }\n                }\n            },\n            removeMenuitem: function () {\n                var remove = function (e) {\n                    if (e.classList.contains('addMenuNot')) return;\n                    e.parentNode.removeChild(e);\n                };\n\n                $$('.addMenuOriginal').forEach((e) => {\n                    let id = e.getAttribute('original-id');\n                    if (id && $(id))\n                        e.parentNode.insertBefore($(id), e);\n                    e.parentNode.removeChild(e);\n                });\n\n                $$('menu.addMenu, menugroup.addMenu').forEach(remove);\n                $$('.addMenu').forEach(remove);\n                // 恢复原隐藏菜单\n                $$('.addMenuHide').forEach(function (e) {\n                    e.classList.remove('addMenuHide');\n                });\n            },\n            setIcon: function (menu, obj) {\n                if (menu.hasAttribute(\"src\") || menu.hasAttribute(\"image\") || menu.hasAttribute(\"icon\"))\n                    return;\n\n                if (obj.exec) {\n                    var aFile = Cc[\"@mozilla.org/file/local;1\"].createInstance(Ci.nsIFile);\n                    try {\n                        aFile.initWithPath(obj.exec);\n                    } catch (e) {\n                        return;\n                    }\n                    // if (!aFile.exists() || !aFile.isExecutable()) {\n                    if (!aFile.exists()) {\n                        menu.setAttribute(\"disabled\", \"true\");\n                    } else {\n                        if (aFile.isFile()) {\n                            let fileURL = this.getURLSpecFromFile(aFile);\n                            menu.setAttribute(\"image\", \"moz-icon://\" + fileURL + \"?size=16\");\n                        } else {\n                            menu.setAttribute(\"image\", \"chrome://global/skin/icons/folder.svg\");\n                        }\n                    }\n                    return;\n                }\n\n                if (obj.keyword) {\n                    let engine = obj.keyword === \"@default\" ? Services.search.getDefault() : Services.search.getEngineByAlias(obj.keyword);\n                    if (engine) {\n                        if (isPromise(engine)) {\n                            engine.then(function (engine) {\n                                if (engine.iconURI) menu.setAttribute(\"image\", engine.iconURI.spec);\n                            });\n                        } else if (engine.iconURI) {\n                            menu.setAttribute(\"image\", engine.iconURI.spec);\n                        }\n                        return;\n                    }\n                }\n                var setIconCallback = function (url) {\n                    let uri, iconURI;\n                    try {\n                        uri = Services.io.newURI(url, null, null);\n                    } catch (e) {\n                        this.log(e)\n                    }\n                    if (!uri) return;\n\n                    menu.setAttribute(\"scheme\", uri.scheme);\n                    PlacesUtils.favicons.getFaviconDataForPage(uri, {\n                        onComplete: function (aURI, aDataLen, aData, aMimeType) {\n                            try {\n                                // javascript: URI の host にアクセスするとエラー\n                                menu.setAttribute(\"image\", aURI && aURI.spec ?\n                                    \"moz-anno:favicon:\" + aURI.spec :\n                                    \"moz-anno:favicon:\" + uri.scheme + \"://\" + uri.host + \"/favicon.ico\");\n                            } catch (e) { }\n                        }\n                    });\n                }\n                PlacesUtils.keywords.fetch(obj.keyword || '').then(entry => {\n                    let url;\n                    if (entry) {\n                        url = entry.url.href;\n                    } else {\n                        url = (obj.url + '').replace(this.regexp, \"\");\n                    }\n                    setIconCallback(url);\n                }, e => {\n                    this.log(e)\n                }).catch(e => { });\n            },\n            setCondition: function (menu, condition) {\n                if (condition) {\n                    let beforeProcessConditons = condition.split(' ');\n                    let conditions = [];\n                    for (let i = 0; i < beforeProcessConditons.length; i++) {\n                        let c = conditions[i] || \"\";\n                        if (c === \"normal\") {\n                            conditions.push(\"normal\");\n                        } else if ([\"select\", \"link\", \"mailto\", \"image\", \"canvas\", \"media\", \"input\"].includes(c.replace(/^no/, \"\"))) {\n                            conditions.push(c);\n                        }\n                    }\n                    if (conditions.length) {\n                        menu.setAttribute(\"condition\", conditions.join(\" \"));\n                    }\n                }\n            },\n            convertText: function (text) {\n                var context = gContextMenu || { // とりあえずエラーにならないようにオブジェクトをでっち上げる\n                    link: {\n                        href: \"\",\n                        host: \"\"\n                    },\n                    target: {\n                        alt: \"\",\n                        title: \"\"\n                    },\n                    __noSuchMethod__: function (id, args) {\n                        return \"\"\n                    },\n                };\n                let tab = TabContextMenu.contextTab || gBrowser.selectedTab || document.popupNode;\n                var bw = gContextMenu ? context.browser : tab.linkedBrowser;\n\n                return text.replace(this.regexp, function (str) {\n                    str = str.toUpperCase().replace(\"%LINK\", \"%RLINK\");\n                    if (str.indexOf(\"_HTMLIFIED\") >= 0)\n                        return htmlEscape(convert(str.replace(\"_HTMLIFIED\", \"\")));\n                    if (str.indexOf(\"_HTML\") >= 0)\n                        return htmlEscape(convert(str.replace(\"_HTML\", \"\")));\n                    if (str.indexOf(\"_ENCODE\") >= 0)\n                        return encodeURIComponent(convert(str.replace(\"_ENCODE\", \"\")));\n                    return convert(str);\n                });\n\n                function convert(str) {\n                    switch (str) {\n                        case \"%T\":\n                            return bw.contentTitle;\n                        case \"%TITLE%\":\n                            return bw.contentTitle;\n                        case \"%TITLES%\":\n                            return bw.contentTitle.replace(/\\s-\\s.*/i, \"\").replace(/_[^\\[\\]【】]+$/, \"\");\n                        case \"%U\":\n                            return bw.documentURI.spec;\n                        case \"%URL%\":\n                            return bw.documentURI.spec;\n                        case \"%H\":\n                            return bw.documentURI.host;\n                        case \"%HOST%\":\n                            return bw.documentURI.host;\n                        case \"%S\":\n                            return (context.selectionInfo && context.selectionInfo.fullText) || addMenu.getSelectedText() || \"\";\n                        case \"%SEL%\":\n                            return (context.selectionInfo && context.selectionInfo.fullText) || addMenu.getSelectedText() || \"\";\n                        case \"%L\":\n                            return context.linkURL || \"\";\n                        case \"%RLINK%\":\n                            return context.linkURL || \"\";\n                        case \"%RLINK_HOST%\":\n                            return context.link.host || \"\";\n                        case \"%RLINK_TEXT%\":\n                            return context.linkText() || \"\";\n                        case \"%RLINK_OR_URL%\":\n                            if (\"linkURL\" in context) {\n                                return context.linkURL;\n                            } else {\n                                return bw.documentURI.spec;\n                            }\n                        case \"%RLT_OR_UT%\":\n                            return context.onLink && context.linkText() || bw.contentTitle; // 链接文本或网页标题\n                        case \"%IMAGE_ALT%\":\n                            return context.target.alt || \"\";\n                        case \"%IMAGE_TITLE%\":\n                            return context.target.title || \"\";\n                        case \"%I\":\n                            return context.imageURL || context.imageInfo.currentSrc || \"\";\n                        case \"%IMAGE_URL%\":\n                            return context.imageURL || context.imageInfo.currentSrc || \"\";\n                        case \"%IMAGE_BASE64%\":\n                            return typeof context.imageURL === \"undefined\" ? img2base64(context.mediaURL) : img2base64(context.imageURL);\n                        case \"%SVG_BASE64%\":\n                            let url = context.linkURL || bw.documentURI.spec || \"\";\n                            return url.endsWith(\"svg\") ? svg2base64(url) : \"\";\n                        case \"%M\":\n                            return context.mediaURL || \"\";\n                        case \"%MEDIA_URL%\":\n                            return context.mediaURL || \"\";\n                        case \"%P\":\n                            return readFromClipboard() || \"\";\n                        case \"%CLIPBOARD%\":\n                            return readFromClipboard() || \"\";\n                        case \"%FAVICON%\":\n                            return tab.faviconUrl || gBrowser.getIcon(tab ? tab : null) || \"\";\n                        case \"%FAVICON_BASE64%\":\n                            let image = tab.faviconUrl || gBrowser.getIcon(tab ? tab : null);\n                            if (image && image.startsWith(\"data:image\")) return image;\n                            return img2base64(image);\n                        case \"%EMAIL%\":\n                            return getEmailAddress() || \"\";\n                        case \"%EOL%\":\n                            return \"\\r\\n\";\n                    }\n                    return str;\n                }\n\n                function htmlEscape(s) {\n                    return (s + \"\").replace(/&/g, \"&amp;\").replace(/>/g, \"&gt;\").replace(/</g, \"&lt;\").replace(/\\\"/g, \"&quot;\").replace(/\\'/g, \"&apos;\");\n                }\n\n                function getEmailAddress() {\n                    var url = context.linkURL;\n                    if (!url || !/^mailto:([^?]+).*/i.test(url)) return \"\";\n                    var addresses = RegExp.$1;\n                    try {\n                        var characterSet = context.target.ownerDocument.characterSet;\n                        const textToSubURI = Cc['@mozilla.org/intl/texttosuburi;1'].getService(Ci.nsITextToSubURI);\n                        addresses = textToSubURI.unEscapeURIForUI(characterSet, addresses);\n                    } catch (ex) { }\n                    return addresses;\n                }\n\n                function img2base64(imgSrc, imgType) {\n                    if (typeof imgSrc == 'undefined') return \"\";\n                    imgType = imgType || \"image/png\";\n                    const NSURI = \"http://www.w3.org/1999/xhtml\";\n                    var img = new Image();\n                    var that = this;\n                    var canvas,\n                        isCompleted = false;\n                    img.onload = function () {\n                        var width = this.naturalWidth,\n                            height = this.naturalHeight;\n                        if (that.appVersion <= 72) {\n                            canvas = document.createXULElementNS(NSURI, \"canvas\");\n                        } else {\n                            canvas = document.createElementNS(NSURI, \"canvas\")\n                        }\n                        canvas.width = width;\n                        canvas.height = height;\n                        var ctx = canvas.getContext(\"2d\");\n                        ctx.drawImage(this, 0, 0);\n                        isCompleted = true;\n                    };\n                    img.onerror = function () {\n                        Cu.reportError($L('could not load', imgSrc));\n                        isCompleted = true;\n                    };\n                    img.src = imgSrc;\n\n                    var thread = Cc['@mozilla.org/thread-manager;1'].getService().mainThread;\n                    while (!isCompleted) {\n                        thread.processNextEvent(true);\n                    }\n\n                    var data = canvas ? canvas.toDataURL(imgType) : \"\";\n                    canvas = null;\n                    return data;\n                }\n\n                function svg2base64(svgSrc) {\n                    if (typeof svgSrc == 'undefined') return \"\";\n                    var xmlhttp = new XMLHttpRequest();\n                    xmlhttp.open(\"GET\", svgSrc, false);\n                    xmlhttp.send();\n                    var svg = xmlhttp.responseText;\n                    // svg string to data url\n                    var svg64 = \"data:image/svg+xml;base64,\" + btoa(svg);\n                    return svg64;\n                }\n            },\n            setSelectedText: function (text) {\n                this._selectedText = text;\n            },\n            getSelectedText: function () {\n                return this._selectedText;\n            },\n            /**\n             * 获取选区\n             * @param {*} win\n             * @returns\n             * @deprecated use getSelectedText instead\n             */\n            getSelection: function (win) {\n                // from getBrowserSelection Fx19\n                win || (win = this.focusedWindow);\n                var selection = this.getRangeAll(win).join(\" \");\n                if (!selection) {\n                    let element = document.commandDispatcher.focusedElement;\n                    let isOnTextInput = function (elem) {\n                        return elem instanceof HTMLTextAreaElement ||\n                            (elem instanceof HTMLInputElement && elem.mozIsTextField(true));\n                    };\n\n                    if (isOnTextInput(element)) {\n                        selection = element.QueryInterface(Ci.nsIDOMNSEditableElement)\n                            .editor.selection.toString();\n                    }\n                }\n\n                if (selection) {\n                    selection = selection.replace(/^\\s+/, \"\")\n                        .replace(/\\s+$/, \"\")\n                        .replace(/\\s+/g, \" \");\n                }\n                return selection;\n            },\n            /**\n             *\n             * @param {*} win\n             * @returns\n             * @deprecated\n             */\n            getRangeAll: function (win) {\n                win || (win = this.focusedWindow);\n                var sel = win.getSelection();\n                var res = [];\n                for (var i = 0; i < sel.rangeCount; i++) {\n                    res.push(sel.getRangeAt(i));\n                };\n                return res;\n            },\n            getInputSelection: function (elem) {\n                if (elem instanceof HTMLTextAreaElement || elem instanceof HTMLInputElement && elem.mozIsTextField(false))\n                    return elem.value.substring(elem.selectionStart, elem.selectionEnd);\n                return \"\";\n            },\n            getURLSpecFromFile(aFile) {\n                var aURL;\n                if (typeof userChrome !== \"undefined\" && typeof userChrome.getURLSpecFromFile !== \"undefined\") {\n                    aURL = userChrome.getURLSpecFromFile(aFile);\n                } else if (this.appVersion < 92) {\n                    aURL = Services.io.getProtocolHandler(\"file\").QueryInterface(Ci.nsIFileProtocolHandler).getURLSpecFromFile(aFile);\n                } else {\n                    aURL = Services.io.getProtocolHandler(\"file\").QueryInterface(Ci.nsIFileProtocolHandler).getURLSpecFromActualFile(aFile);\n                }\n                return aURL;\n            },\n            edit: function (aFile, aLineNumber) {\n                if (!aFile || !aFile.exists() || !aFile.isFile()) return;\n\n                var editor;\n                try {\n                    editor = Services.prefs.getComplexValue(\"view_source.editor.path\", Ci.nsIFile);\n                } catch (e) { }\n\n                if (!editor || !editor.exists()) {\n                    if (useScraptchpad && this.appVersion <= 72) {\n                        this.openScriptInScratchpad(window, aFile);\n                        return;\n                    } else {\n                        alert($L('please set editor path'));\n                        var fp = Cc['@mozilla.org/filepicker;1'].createInstance(Ci.nsIFilePicker);\n                        fp.init(window, $L('set global editor'), fp.modeOpen);\n                        fp.appendFilter($L('executable files'), \"*.exe\");\n\n                        if (typeof fp.show !== 'undefined') {\n                            if (fp.show() == fp.returnCancel || !fp.file)\n                                return;\n                            else {\n                                editor = fp.file;\n                                Services.prefs.setCharPref(\"view_source.editor.path\", editor.path);\n                            }\n                        } else {\n                            fp.open(res => {\n                                if (res != Ci.nsIFilePicker.returnOK) return;\n                                editor = fp.file;\n                                Services.prefs.setCharPref(\"view_source.editor.path\", editor.path);\n                            });\n                        }\n                    }\n                }\n\n                var aURL = this.getURLSpecFromFile(aFile);\n                var aDocument = null;\n                var aCallBack = null;\n                var aPageDescriptor = null;\n                gViewSourceUtils.openInExternalEditor({\n                    URL: aURL,\n                    lineNumber: aLineNumber\n                }, aPageDescriptor, aDocument, aLineNumber, aCallBack);\n            },\n            /**\n             * 使用 Scratchpad 编辑\n             * @param {*} parentWindow\n             * @param {*} file\n             * @deprecated\n             */\n            openScriptInScratchpad: function (parentWindow, file) {\n                let spWin = window.openDialog(\"chrome://devtools/content/scratchpad/index.xul\", \"Toolkit:Scratchpad\", \"chrome,dialog,centerscreen,dependent\");\n                spWin.top.moveTo(0, 0);\n                spWin.top.resizeTo(screen.availWidth, screen.availHeight);\n\n                spWin.addEventListener(\"load\", function spWinLoaded() {\n                    spWin.removeEventListener(\"load\", spWinLoaded, false);\n\n                    let Scratchpad = spWin.Scratchpad;\n                    Scratchpad.setFilename(file.path);\n                    Scratchpad.addObserver({\n                        onReady: function () {\n                            Scratchpad.removeObserver(this);\n                            Scratchpad.importFromFile.call(Scratchpad, file);\n                        }\n                    });\n                }, false);\n            },\n            copy: function (aText) {\n                Cc[\"@mozilla.org/widget/clipboardhelper;1\"].getService(Ci.nsIClipboardHelper).copyString(aText);\n                //XULBrowserWindow.statusTextField.label = \"Copy: \" + aText;\n            },\n            copyLink: function (copyURL, copyLabel) {\n                // generate the Unicode and HTML versions of the Link\n                var textUnicode = copyURL;\n                var textHtml = (\"<a href=\\\"\" + copyURL + \"\\\">\" + copyLabel + \"</a>\");\n\n                // make a copy of the Unicode\n                var str = Components.classes[\"@mozilla.org/supports-string;1\"].createInstance(Components.interfaces.nsISupportsString);\n                if (!str) return false; // couldn't get string obj\n                str.data = textUnicode; // unicode string?\n\n                // make a copy of the HTML\n                var htmlstring = Components.classes[\"@mozilla.org/supports-string;1\"].createInstance(Components.interfaces.nsISupportsString);\n                if (!htmlstring) return false; // couldn't get string obj\n                htmlstring.data = textHtml;\n\n                // add Unicode & HTML flavors to the transferable widget\n                var trans = Components.classes[\"@mozilla.org/widget/transferable;1\"].createInstance(Components.interfaces.nsITransferable);\n                if (!trans) return false; //no transferable widget found\n\n                trans.addDataFlavor(\"text/unicode\");\n                trans.setTransferData(\"text/unicode\", str, textUnicode.length * 2); // *2 because it's unicode\n\n                trans.addDataFlavor(\"text/html\");\n                trans.setTransferData(\"text/html\", htmlstring, textHtml.length * 2); // *2 because it's unicode\n\n                // copy the transferable widget!\n                var clipboard = Components.classes[\"@mozilla.org/widget/clipboard;1\"].getService(Components.interfaces.nsIClipboard);\n                if (!clipboard) return false; // couldn't get the clipboard\n\n                clipboard.setData(trans, null, Components.interfaces.nsIClipboard.kGlobalClipboard);\n                return true;\n            },\n            alert: function (aMsg, aTitle, aCallback) {\n                var callback = aCallback ? {\n                    observe: function (subject, topic, data) {\n                        if (\"alertclickcallback\" != topic)\n                            return;\n                        aCallback.call(null);\n                    }\n                } : null;\n                var alertsService = Cc[\"@mozilla.org/alerts-service;1\"].getService(Ci.nsIAlertsService);\n                alertsService.showAlertNotification(\n                    this.appVersion >= 78 ? \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSJjb250ZXh0LWZpbGwiIGZpbGwtb3BhY2l0eT0iY29udGV4dC1maWxsLW9wYWNpdHkiPjxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0wIDBoMjR2MjRIMHoiLz48cGF0aCBkPSJNMTIgMjJDNi40NzcgMjIgMiAxNy41MjMgMiAxMlM2LjQ3NyAyIDEyIDJzMTAgNC40NzcgMTAgMTAtNC40NzcgMTAtMTAgMTB6bTAtMmE4IDggMCAxIDAgMC0xNiA4IDggMCAwIDAgMCAxNnpNMTEgN2gydjJoLTJWN3ptMCA0aDJ2NmgtMnYtNnoiLz48L3N2Zz4=\" : \"chrome://global/skin/icons/information-32.png\", aTitle || \"addMenuPlus\",\n                    aMsg + \"\", !!callback, \"\", callback);\n            },\n            $$: function (exp, context, aPartly) {\n                context || (context = this.focusedWindow.document);\n                var doc = context.ownerDocument || context;\n                var elements = $$(exp, doc);\n                if (arguments.length <= 2)\n                    return elements;\n                var sel = doc.defaultView.getSelection();\n                return elements.filter(function (q) {\n                    return sel.containsNode(q, aPartly)\n                });\n            },\n            log: log,\n        }\n\n        function $(id) {\n            return document.getElementById(id);\n        }\n\n        function $$(exp, doc) {\n            return Array.prototype.slice.call((doc || document).querySelectorAll(exp));\n        }\n\n        function $A(args) {\n            return Array.prototype.slice.call(args);\n        }\n\n        function log() {\n            console.log(Array.prototype.slice.call(arguments));\n        }\n\n        function U(text) {\n            return 1 < 'あ'.length ? decodeURIComponent(escape(text)) : text\n        };\n\n        function $C(name, attr) {\n            const appVersion = Services.appinfo.version.split(\".\")[0];\n            attr || (attr = {});\n            var el;\n            if (appVersion >= 69) {\n                el = document.createXULElement(name);\n            } else {\n                el = document.createElement(name);\n            }\n            if (attr) Object.keys(attr).forEach(function (n) {\n                el.setAttribute(n, attr[n])\n            });\n            return el;\n        }\n\n        function loadText(aFile) {\n            var fstream = Cc[\"@mozilla.org/network/file-input-stream;1\"].createInstance(Ci.nsIFileInputStream);\n            var sstream = Cc[\"@mozilla.org/scriptableinputstream;1\"].createInstance(Ci.nsIScriptableInputStream);\n            fstream.init(aFile, -1, 0, 0);\n            sstream.init(fstream);\n\n            var data = sstream.read(sstream.available());\n            try {\n                data = decodeURIComponent(escape(data));\n            } catch (e) { }\n            sstream.close();\n            fstream.close();\n            return data;\n        }\n\n        function loadFile(aLeafName) {\n            var aFile = Cc[\"@mozilla.org/file/directory_service;1\"]\n                .getService(Ci.nsIDirectoryService)\n                .QueryInterface(Ci.nsIProperties)\n                .get('UChrm', Ci.nsIFile);\n            aFile.appendRelativePath(aLeafName);\n            if (!aFile.exists() || !aFile.isFile()) return null;\n            var fstream = Cc[\"@mozilla.org/network/file-input-stream;1\"].createInstance(Ci.nsIFileInputStream);\n            var sstream = Cc[\"@mozilla.org/scriptableinputstream;1\"].createInstance(Ci.nsIScriptableInputStream);\n            fstream.init(aFile, -1, 0, 0);\n            sstream.init(fstream);\n            var data = sstream.read(sstream.available());\n            try {\n                data = decodeURIComponent(escape(data));\n            } catch (e) { }\n            sstream.close();\n            fstream.close();\n            return data;\n        }\n\n        function addStyle(css) {\n            var pi = document.createProcessingInstruction(\n                'xml-stylesheet',\n                'type=\"text/css\" href=\"data:text/css;utf-8,' + encodeURIComponent(css) + '\"'\n            );\n            return document.insertBefore(pi, document.documentElement);\n        }\n\n        function saveFile(fileOrName, data) {\n            var file;\n            if (typeof fileOrName == \"string\") {\n                file = Services.dirsvc.get('UChrm', Ci.nsIFile);\n                file.appendRelativePath(fileOrName);\n            } else {\n                file = fileOrName;\n            }\n\n            var suConverter = Cc[\"@mozilla.org/intl/scriptableunicodeconverter\"].createInstance(Ci.nsIScriptableUnicodeConverter);\n            suConverter.charset = 'UTF-8';\n            data = suConverter.ConvertFromUnicode(data);\n\n            var foStream = Cc['@mozilla.org/network/file-output-stream;1'].createInstance(Ci.nsIFileOutputStream);\n            foStream.init(file, 0x02 | 0x08 | 0x20, 0o664, 0);\n            foStream.write(data, data.length);\n            foStream.close();\n        }\n\n        function capitalize(s) {\n            return s && s[0].toUpperCase() + s.slice(1);\n        }\n\n        function $L() {\n            let key = arguments[0];\n            if (key) {\n                if (!ADDMENU_LANG[ADDMENU_LOCALE].hasOwnProperty(key)) return capitalize(key);\n                let str = ADDMENU_LANG[ADDMENU_LOCALE][key];\n                for (let i = 1; i < arguments.length; i++) {\n                    str = str.replace(\"%s\", arguments[i]);\n                }\n                return str;\n            } else return \"\";\n        }\n\n        function isDef(v) {\n            return v !== undefined && v !== null\n        }\n\n        function isPromise(val) {\n            return (\n                isDef(val) &&\n                typeof val.then === 'function' &&\n                typeof val.catch === 'function'\n            )\n        }\n\n        window.addMenu.init();\n    })(`\n    .addMenuHide {\n        display: none !important;\n    }\n    #contentAreaContextMenu > .addMenu:not(menugroup),\n    #contentAreaContextMenu > menugroup > .addMenu[condition],\n    #contentAreaContextMenu menugroup.addMenu[condition] {\n        display: none;\n    }\n    #contentAreaContextMenu[addMenu~=\"link\"]   .addMenu[condition~=\"link\"],\n    #contentAreaContextMenu[addMenu~=\"mailto\"] .addMenu[condition~=\"mailto\"],\n    #contentAreaContextMenu[addMenu~=\"image\"]  .addMenu[condition~=\"image\"],\n    #contentAreaContextMenu[addMenu~=\"canvas\"] .addMenu[condition~=\"canvas\"],\n    #contentAreaContextMenu[addMenu~=\"media\"]  .addMenu[condition~=\"media\"],\n    #contentAreaContextMenu[addMenu~=\"input\"]  .addMenu[condition~=\"input\"],\n    #contentAreaContextMenu[addMenu=\"\"] .addMenu[condition~=\"normal\"],\n    #contentAreaContextMenu:not([addMenu~=\"select\"]) .addMenu[condition~=\"noselect\"],\n    #contentAreaContextMenu:not([addMenu~=\"link\"])   .addMenu[condition~=\"nolink\"],\n    #contentAreaContextMenu:not([addMenu~=\"mailto\"]) .addMenu[condition~=\"nomailto\"],\n    #contentAreaContextMenu:not([addMenu~=\"image\"])  .addMenu[condition~=\"noimage\"],\n    #contentAreaContextMenu:not([addMenu~=\"canvas\"])  .addMenu[condition~=\"nocanvas\"],\n    #contentAreaContextMenu:not([addMenu~=\"media\"])  .addMenu[condition~=\"nomedia\"],\n    #contentAreaContextMenu:not([addMenu~=\"input\"])  .addMenu[condition~=\"noinput\"] {\n        display: flex; display: -moz-box;\n    }\n    #toolbar-context-menu:not([addMenu~=\"menubar\"]) .addMenu[condition~=\"menubar\"],\n    #toolbar-context-menu:not([addMenu~=\"tabs\"]) .addMenu[condition~=\"tabs\"],\n    #toolbar-context-menu:not([addMenu~=\"navbar\"]) .addMenu[condition~=\"navbar\"],\n    #toolbar-context-menu:not([addMenu~=\"personal\"]) .addMenu[condition~=\"personal\"],\n    #toolbar-context-menu:not([addMenu~=\"button\"]) .addMenu[condition~=\"button\"],\n    #toolbar-context-menu[addMenu~=\"menubar\"] .addMenu[condition~=\"nomenubar\"],\n    #toolbar-context-menu[addMenu~=\"tabs\"] .addMenu[condition~=\"notabs\"],\n    #toolbar-context-menu[addMenu~=\"navbar\"] .addMenu[condition~=\"nonavbar\"],\n    #toolbar-context-menu[addMenu~=\"personal\"] .addMenu[condition~=\"nopersonal\"],\n    #toolbar-context-menu[addMenu~=\"button\"] .addMenu[condition~=\"nobutton\"],\n    #toolbar-context-menu:not([addMenu=\"\"]) .addMenu[condition~=\"normal\"] {\n        display: none !important;\n    }\n    .addMenu-insert-point,\n    toolbarseparator:not(.addMenu-insert-point)+toolbarseparator {\n        display: none !important;\n    }\n    .addMenu[url] {\n        list-style-image: url(\"chrome://mozapps/skin/places/defaultFavicon.png\");\n    }\n    .addMenu.exec,\n    .addMenu[exec] {\n        list-style-image: url(\"chrome://devtools/content/debugger/images/window.svg\");\n    }\n    .addMenu.copy,\n    menuitem.addMenu[text]:not([url]):not([keyword]):not([exec]) {\n        list-style-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJjb250ZXh0LWZpbGwiIGZpbGwtb3BhY2l0eT0iY29udGV4dC1maWxsLW9wYWNpdHkiPjxwYXRoIGQ9Ik00IDJDMi44OTUgMiAyIDIuODk1IDIgNEwyIDE3QzIgMTcuNTUyIDIuNDQ4IDE4IDMgMThDMy41NTIgMTggNCAxNy41NTIgNCAxN0w0IDRMMTcgNEMxNy41NTIgNCAxOCAzLjU1MiAxOCAzQzE4IDIuNDQ4IDE3LjU1MiAyIDE3IDJMNCAyIHogTSA4IDZDNi44OTUgNiA2IDYuODk1IDYgOEw2IDIwQzYgMjEuMTA1IDYuODk1IDIyIDggMjJMMjAgMjJDMjEuMTA1IDIyIDIyIDIxLjEwNSAyMiAyMEwyMiA4QzIyIDYuODk1IDIxLjEwNSA2IDIwIDZMOCA2IHogTSA4IDhMMjAgOEwyMCAyMEw4IDIwTDggOCB6Ii8+PC9zdmc+);\n      -moz-image-region: rect(0pt, 16px, 16px, 0px);\n    }\n    .addMenu.checkbox .menu-iconic-icon {\n        -moz-appearance: checkbox;\n    }\n    .addMenu > .menu-iconic-left {\n        -moz-appearance: menuimage;\n    }\n    .addMenu > .menu-iconic-left > .menu-iconic-icon {\n        -moz-context-properties: fill, fill-opacity !important;\n        fill: currentColor !important;\n    }\n    #contentAreaContextMenu[photoncompact=\"true\"]:not([needsgutter]) > .addMenu:is(menu, menuitem) > .menu-iconic-left,\n    #contentAreaContextMenu[photoncompact=\"true\"]:not([needsgutter]) > menugroup.addMenu >.addMenu.showText > .menu-iconic-left,\n    #contentAreaContextMenu[photoncompact=\"true\"]:not([needsgutter]) > menugroup.addMenu.showText >.addMenu > .menu-iconic-left {\n        visibility: collapse;\n    }\n    menugroup.addMenu > .menuitem-iconic.fixedSize {\n        -moz-box-flex: 0;\n        flex-grow: 0;\n        flex-shrink: 0;\n        padding-inline-end: 8px;\n    }\n    menugroup.addMenu > .menuitem-iconic {\n        -moz-box-flex: 1;\n        -moz-box-pack: center;\n        -moz-box-align: center;\n        flex-grow: 1;\n        justify-content: center;\n        align-items: center;\n        padding-block: 6px;\n        padding-inline-start: 1em;\n    }\n    menugroup.addMenu > .menuitem-iconic > .menu-iconic-left {\n        -moz-appearance: none;\n        padding-top: 0;\n    }\n    menugroup.addMenu > .menuitem-iconic > .menu-iconic-left > .menu-iconic-icon {\n        width: 16px;\n        height: 16px;\n    }\n    menugroup.addMenu:not(.showText):not(.showFirstText) > .menuitem-iconic:not(.showText) > .menu-iconic-text,\n    menugroup.addMenu.showFirstText > .menuitem-iconic:not(:first-child) > .menu-iconic-text,\n    menugroup.addMenu > .menuitem-iconic > .menu-accel-container {\n        display: none;\n    }\n    menugroup.addMenu > .menuitem-iconic {\n        padding-inline-end: 1em;\n    }\n    menugroup.addMenu.showFirstText > .menuitem-iconic:not(:first-child):not(.showText),\n    menugroup.addMenu:not(.showText):not(.showFirstText) > .menuitem-iconic:not(.showText) {\n        padding-left: 0;\n        -moz-box-flex: 0;\n        flex-grow: 0;\n        flex-shrink: 0;\n        padding-inline-end: 0;\n    }\n    menugroup.addMenu.showFirstText > .menuitem-iconic:not(:first-child):not(.showText) > .menu-iconic-left,\n    menugroup.addMenu:not(.showText):not(.showFirstText) > .menuitem-iconic:not(.showText) > .menu-iconic-left {\n        margin-inline-start: 8px;\n        margin-inline-end: 8px;\n    }\n`)\n}","fileName":"addMenuPlus_fx70.uc.js","previewEditPath":"/benzBrake/FirefoxCustomize/preview/master/userChromeJS/addMenuPlus/addMenuPlus_fx70.uc.js","isNewFile":false,"binary":false,"enableCommitButton":null,"slashCommandsEnabled":true,"helpUrl":"https://docs.github.com","codeMirror":{"indentSize":4,"indentMode":"space","lineWrapping":"off","showFileActions":true},"editors":{"stacksEnabled":true,"actionsEnabled":true,"dependabotEditorEnabled":false,"devcontainerEditorEnabled":true,"isEnterprise":false,"isProxima":false,"repositoryActionsEnabled":true,"repositoryActionsReadinessPath":"/benzBrake/FirefoxCustomize/settings/actions/check_readiness"},"templates":{"issueFormsEnabled":true,"showIssueFormWarning":false},"pickers":{"licensePickerAvailable":false,"licenseToolPath":"/benzBrake/FirefoxCustomize/community/license/new?branch=master","codeOfConductPickerAvailable":false,"codeOfConductToolPath":"/benzBrake/FirefoxCustomize/community/code-of-conduct/new"},"banners":{"citationHelpUrl":"https://docs.github.com/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","editRepoPath":"/benzBrake/FirefoxCustomize/settings","hasMixedLineEndings":null,"orgMemberProfileReadmeCalloutEnabled":false,"orgProfileReadmeCalloutEnabled":false,"profileReadmeCalloutEnabled":false,"replacedDetectedEncoding":null,"repositoryCitationTemplateUrl":"https://github.com/benzBrake/FirefoxCustomize/citation_file_template","repositoryFundingLinksEnabled":true,"sponsorsEnabled":true},"unblockSecretPath":"/benzBrake/FirefoxCustomize/edit/unblock-secret/master/userChromeJS/addMenuPlus/addMenuPlus_fx70.uc.js","uploadPolicyPath":"/upload/policies/assets","uploadExtensions":[".gif",".jpeg",".jpg",".mov",".mp4",".png",".svg",".webm"],"renderableExtensions":[".md",".livemd",".markdown",".mdown",".mdwn",".mkd",".mkdn",".mkdown",".ronn",".scd",".workbook",".litcoffee",".coffee.md",".textile",".rdoc",".org",".creole",".mediawiki",".wiki",".wikitext",".asciidoc",".adoc",".asc",".rst",".rest",".rest.txt",".rst.txt",".pod",".pod6"],"isOnboardingGuidance":false},"webCommitInfo":{"authorEmails":[],"canCommitStatus":"allowed","commitOid":"88b44db0e6a51048f527adc91655918201cc46f3","dcoSignoffEnabled":false,"dcoSignoffHelpUrl":null,"defaultEmail":null,"defaultNewBranchName":"shredthaGNAR-patch-1","guidanceTask":null,"saveUrl":"/benzBrake/FirefoxCustomize/tree-save/master/userChromeJS/addMenuPlus/addMenuPlus_fx70.uc.js","forkedRepo":{"id":545241767,"name":"FirefoxCustomize","owner":"shredthaGNAR"},"repoHeadEmpty":false,"shouldFork":false,"shouldUpdate":false,"lockedOnMigration":false,"pr":null,"protectionNotEnforcedInfo":null,"suggestionsUrlMention":"/suggestions?mention_suggester=1&repository=FirefoxCustomize&user_id=benzBrake","suggestionsUrlIssue":"/suggestions?issue_suggester=1&repository=FirefoxCustomize&user_id=benzBrake","suggestionsUrlEmoji":"/autocomplete/emoji"},"path":"userChromeJS/addMenuPlus/addMenuPlus_fx70.uc.js","copilotInfo":{"documentationUrl":"https://docs.github.com/copilot/overview-of-github-copilot/about-github-copilot-for-individuals","notices":{"codeViewPopover":{"dismissed":false,"dismissPath":"/settings/dismiss-notice/code_view_copilot_popover"}},"userAccess":{"accessAllowed":false,"hasSubscriptionEnded":false,"orgHasCFBAccess":false,"userHasCFIAccess":false,"userHasOrgs":false,"userIsOrgAdmin":false,"userIsOrgMember":false,"business":null,"featureRequestInfo":null}},"csrf_tokens":{"/benzBrake/FirefoxCustomize/tree-save/master/userChromeJS/addMenuPlus/addMenuPlus_fx70.uc.js":{"post":"4_ul5NlO9KpCoyDN9IsUXExLiTqFnHIyu-18iiOzbmH17wZS0I9fDBgAicLb8egh93NzzpSXXHLwfHJe2tHx4A"},"/benzBrake/FirefoxCustomize/edit/master/userChromeJS/addMenuPlus/addMenuPlus_fx70.uc.js":{"post":"hAqhQl4gLvU8iunVaeBuBp1doNrsGNJcJKPdxqdr1LN5paeKHb0suWSNpWSuI-y07hUBpHeU2yrNrxDafFwtPQ"},"/benzBrake/FirefoxCustomize/preview/master/userChromeJS/addMenuPlus/addMenuPlus_fx70.uc.js":{"post":"RftFmVQBIbwMdhO0Q8MChGd_ccDQk0zz4AWfrZSwxKP2qrohlrW7Ov8DViAhSwjqjsmWKRkJ2-W8N-Ow9_Tskg"},"/benzBrake/FirefoxCustomize/edit/unblock-secret/master/userChromeJS/addMenuPlus/addMenuPlus_fx70.uc.js":{"post":"I3XzF1Lbiowbl43c3YbGYtmmXgSYFZIPavCx5tlEXqiHyrikXVwzi2mLMHhQFiZsDIGiwlmAjvReEI9lMRTtxA"},"/upload/policies/assets":{"post":"3Du7JqrSAi20o2yHKono7jnM0_Gn5z6Nz1o_RHscvACWmjcvr5ZmMgm94ni1EEuG307YJRv5T__OmpA8PBOgPQ"}}},"title":"Editing FirefoxCustomize/userChromeJS/addMenuPlus/addMenuPlus_fx70.uc.js at master · benzBrake/FirefoxCustomize"}